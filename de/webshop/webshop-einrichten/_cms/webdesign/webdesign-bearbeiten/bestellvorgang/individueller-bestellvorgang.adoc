= Individueller Bestellvorgang
:lang: de
// include::{includedir}/_header.adoc[]
:keywords: Individueller Bestellvorgang, CMS, plentymarkets
:position: 15
:icons: font
:docinfodir: /workspace/manual-adoc
:docinfo1:

Der Bestellvorgang bezeichnet den Prozess des Kaufens im Online-Shop von dem Augenblick an, in dem der Kunde einen Artikel in den Warenkorb legt, bis zu dem Moment, in dem der Kunde die Bestellung abschickt. In *Callisto Light* ist der Individuelle Bestellvorgang standardmäßig eingestellt. Der Individuelle Bestellvorgang ermöglicht dir volle Kontrolle über das Aussehen, den Funktionsumfang und den Verlauf des Kaufprozesses. Du legst in bis zu zehn Schritten fest, wie Kunden deinen persönlichen Bestellvorgang durchlaufen sollen. Zusätzlich gestaltest du die Schritte *Login*, *Logout*, *Kundenregistrierung*, *Passwort vergessen* und *Bestellbestätigung*. +
Diese Handbuchseite beschreibt den Aufbau des Individuellen Bestellvorgangs sowie Konfigurations- und Einstellungsmöglichkeiten. +
Die aufgeführten Einstellungen für den Bestellvorgang werden für jedes Design separat und dort pro Mandant (Shop) vorgenommen. Auch die Anzahl und den Inhalt der einzelnen Schritte des Bestellvorgangs gestaltest du pro Mandant.

[IMPORTANT]
.Wechsel auf den Individuellen Bestellvorgang
====
Ein Wechsel vom Standard-Bestellvorgang auf den Individuellen Bestellvorgang kann aus technischen Gründen nicht mehr rückgängig gemacht werden.
====

== Bestandteile des Individuellen Bestellvorgangs in Callisto Light

Der Aufbau des Individuellen Bestellvorgangs wird im Folgenden in den Kapiteln *Kategorien*, *Bestellschritte*, *Kopfzeile Kasse* und *Zusätzliche Seiten* erläutert.

=== Kategorien

Mit dem Individuellen Bestellvorgang wurden Kategorien des Typs <<artikel/kategorien-verwalten#, Container>> eingeführt. Kategorien dieses Typs können auf alle globalen Template-Variablen und -Funktionen der Checkout-Templates des Bereichs *CMS » Webdesign » Layout » Checkout* zugreifen. Über globale Template-Variablen und -Funktionen ist wiederum ein Zugriff von den Kategorien des Typs *Container* auf Template-spezifische, d.h. nicht globale Variablen und Funktionen möglich. Der gesamte Bestellvorgang kann so vollständig in Kategorien abgebildet werden. Die Verwendung von Templates ist im Individuellen Bestellvorgang somit nicht mehr zwingend erforderlich. Die Kategorien von Callisto Light findest du in plentymarkets unter *Artikel » Kategorien* im Ordner deines Designs. Dort gestaltest du die Inhalte der Bestellschritte. Um von einer Kategorie auf eine andere Kategorie zu verlinken, nutzt du die <<omni-channel/online-shop/webshop-einrichten/cms-syntax#webdesign-pagedesign-link, Link-Funktionen>>. Es stehen dir vordefinierte Funktionen zur Verfügung:

.Vordefinierte Template-Funktionen
[cols="1,3"]
|====
|Funktionsaufruf |Zurückgelieferter Link

|*Link_CustomerRegistration()*
|Kundenregistrierung

|*Link_LostPassword()*
|Passwort vergessen

|*Link_OrderConfirmation()*
|Bestellbestätigung

|*Link_Checkout(1)*
|Anmeldung

|*Link_Checkout(2)*
|Warenkorb

|*Link_Checkout(3)*
|Kasse

|*Link_Checkout(4)*
|Bestelldetails

|*Link_Checkout(5)*
|Anschrift

|*Link_Checkout(x)*
|x: Nummer des Bestellschritts im Bestellvorgang
|====


Kategorien, z.B. für *Kundenregistrierung* und *Bestellbestätigung*, kannst du mit Hilfe von Anchor-Tags an beliebiger Stelle im Bestellvorgang verlinken.

[source,plenty]
----
include::assets/EX-DE-IndividuellerBestellvorgang-01.html[]

----

_Codebeispiel 1: Code für Schaltfläche *Zur Kasse*_

Codebeispiel 1 stammt aus der Kategorie *Warenkorb* von Callisto Light. Kunden wird darüber die Schaltfläche *Zur Kasse* angezeigt (<<bild-button-kasse>>). Im Code wird auch geprüft, ob der Kunde im System angemeldet ist. Ist der Kunde nicht angemeldet, wird für das href-Attribut der Schaltflächen die Funktion *Link_CustomerRegistration()* hinterlegt. Der Kunde wird bei Klick auf die Schaltfläche *Zur Kasse* zur Kundenregistrierung geleitet. Dort kann sich der Kunde im System anmelden oder ein neues Kundenkonto erstellen. Ist der Kunde bereits im System angemeldet, führt der Link zum Bestellschritt *Bestelldetails*, d.h. dem ersten Bestellschritt der Kopfzeile *Kasse*, da für diesen Fall die Template-Funktion *Link_Checkout(3)* hinterlegt wurde.

[[bild-button-kasse]]
.Schaltfläche *Zur Kasse*, der durch Codebeispiel 1 erzeugt wird
image::omni-channel/online-shop/webshop-einrichten/_cms/webdesign/webdesign-bearbeiten/bestellvorgang/assets/DE-CMS-IndividuellerBestellvorgang-01.png[]

=== Bestellschritte

Für die acht Bestellschritte des Individuellen Bestellvorgangs in *Callisto Light* sind in den <<omni-channel/online-shop/cms#webdesign-webdesign-bearbeiten, Design-Einstellungen>> Kategorien verknüpft (<<bild-bestellschritte-callisto-light>>).

In *Callisto Light* sind für den Bestellvorgang acht Schritte hinterlegt:

. Warenkorb
. Anmeldung
. Kasse
. Bestelldetails
. Anschrift
. Zahlung &amp; Versand
. Bestellübersicht &amp; Kaufabschluss
. Bestellvorgang

Diese acht Schritte werden über Kategorien des Typs *Container* dargestellt. Die Kategorien von Callisto Light findest du in plentymarkets unter *Artikel » Kategorien* im Ordner deines Designs. Zusätzlich stehen zwei weitere Bestellschritte (9. Bestellschritt und 10. Bestellschritt) zur Verfügung. Insgesamt lassen sich im Individuellen Bestellvorgang also zehn Bestellschritte einrichten (<<bild-bestellschritte-callisto-light>>). Außerdem besteht die Möglichkeit, fünf zusätzliche Seiten anzulegen (<<bild-bestellschritte-callisto-light>>).

[[bild-bestellschritte-callisto-light]]
.Voreingestellte Bestellschritte in *Callisto Light*
image::omni-channel/online-shop/webshop-einrichten/_cms/webdesign/webdesign-bearbeiten/bestellvorgang/assets/DE-CMS-IndividuellerBestellvorgang-02.png[]

Die folgende Tabelle zeigt die zehn konfigurierbaren Bestellschritte des Individuellen Bestellvorgangs und verdeutlicht deren Funktion im Frontend, d.h. im Online-Shop.

[[tabelle-bestellschritte-individueller-bestellvorgang]]
.Bestellschritte des Individuellen Bestellvorgangs
[cols="1,3,3"]
|====
|Nr. |Schritt im Backend |Funktion im Frontend

|*1*
|Warenkorb
|Übersicht aller Artikel, die der Kunde kaufen möchte.

|*2*
|Anmeldung
|Kunden entscheiden, ob sie als Gast oder als registrierte Benutzer zur Kasse gehen.

|*3*
|Kasse
a| Dient als Kopfzeile für die folgenden Bestellschritte (<<bild-bestellschritte-kasse>>):
* Bestelldetails
* Anschrift
* Zahlung &amp; Versand
* Übersicht &amp; Vertragsabschluss

|*4*
|Bestelldetails
|Wird im Frontend als Tab *Bestelldetails* der logischen Einheit *Kasse* dargestellt.

|*5*
|Anschrift
|Wird im Frontend als Tab *Anschrift* der logischen Einheit *Kasse* dargestellt.

|*6*
|Zahlung &amp; Versand
|Wird im Frontend als Tab *Zahlung &amp; Versand* der logischen Einheit *Kasse* dargestellt.

|*7*
|Bestellübersicht &amp; Kaufabschluss
|Wird im Frontend als Tab *Übersicht &amp; Vertragsabschluss* der logischen Einheit *Kasse* dargestellt.

|*8*
|Bestellvorgang
a| Stellt zur Auswahl, wohin der Kunde als Nächstes navigieren kann:
* Warenkorb
* Kasse
* Anmeldung

*Hinweis:* Bestellschritt ist namensgleich mit dem Bestellvorgang als Ganzes. Diese Namensgleichheit beruht auf technischen Begebenheiten.

|*9*
|Frei
|Nicht in Benutzung. Kann konfiguriert werden.

|*10*
|Frei
|Nicht in Benutzung. Kann konfiguriert werden.
|====

=== Kopfzeile Kasse

Der dritte Bestellschritt, die Kategorie *Kasse*, stellt einen Sonderfall dar, da dieser Schritt die in <<tabelle-bestellschritte-individueller-bestellvorgang>> beschriebenen vier Bestellschritte beinhaltet. In der Kategorie *Kasse* wird die Abfolge dieser vier Bestellschritte geregelt. Die Kasse wird im individuellen Bestellvorgang von *Callisto Light* als Kopfzeile und Fortschrittsanzeige genutzt, anhand derer Kunden ihren Fortschritt ablesen können (<<bild-bestellschritte-kasse>>).

[[bild-bestellschritte-kasse]]
.Bestellschritte der Kategorie *Kasse*
image::omni-channel/online-shop/webshop-einrichten/_cms/webdesign/webdesign-bearbeiten/bestellvorgang/assets/DE-CMS-IndividuellerBestellvorgang-03.png[]

.Bestellschritte der Kopfzeile *Kasse*
[cols="1,3"]
|====
|Bestellschritte der Kategorie Kasse |Inhalt

|*1. Bestelldetails*
a| Eingabefelder:
* Ihr Zeichen
* Hinweise &amp; Sonderwünsche
* Gutschein-Codes

|*2. Anschrift*
a|
* Rechnungsanschrift
* Angabe abweichender Lieferanschrift

Optionale Felder:
* Fax
* Mobile
* Postnummer
* USt-IdNr.

|*3. Zahlung &amp; Versand*
a|
* Auswahl der Zahlungsarten
* Auswahl des Versanddienstleisters

|*4. Übersicht &amp; Vertragsabschluss*
a|
* Zusammenfassung der Bestellung
* AGB-Einwilligung
* Newsletter-Anmeldung

|====

In *Callisto Light* werden die Schritte des Bestellvorgangs mit Hilfe von JavaScript dynamisch ein- und ausgeblendet. Die Daten in den vier Bestellschritten der Kopfzeile Kasse (<<bild-bestellschritte-kasse>>) werden mit Hilfe von REST-Calls im Hintergrund mit dem Server ausgetauscht und aktuell gehalten. Den Code für die Darstellung der Kopfzeile *Kasse* findest du in plentymarkets im Ordner deines Designs unter *Artikel » Kategorien » Kasse*.

In der Kategorie *Kasse* wird der Code der vier Bestellschritte über die Funktion *CategoryContentBody($_id)* geladen. Du findest die Bestellschritte am einfachsten über die HTML-Kommentare in der Kategorie:

.Bestellschritte in der Kategorie *Kasse*
[cols="1,3"]
|====
|Bestellschritt |HTML-Kommentar

|*Bestelldetails*
|STEP 1: Order details

|*Anschrift*
|STEP 2: Addresses

|*Zahlung &amp; Versand*
|STEP 3: Shipping &amp; Payment

|*Übersicht &amp; Vertragsabschluss*
|STEP 4: Overview &amp; Confirmation
|====

Codebeispiel 2 zeigt, wie der Inhalt der Kopfzeile *Kasse* mit den Bestellschritten *Bestelldetails*, *Anschrift*, *Zahlung &amp; Versand* und *Übersicht &amp; Vertragsabschluss* in *Callisto Light* geladen wird.

Codebeispiel 2 stammt aus der Kategorie *Kasse* und beinhaltet die oben aufgeführten Bestellschritte. In Zeile 7 des Codebeispiels 2 wird mit der Anweisung *$_id= CheckoutStepPageID(4)* die ID für den Bestellschritt *Bestelldetails* in der Variablen *$_id* gespeichert. Die Ziffern in der Klammer von *CheckoutStepPageID* entsprechen der Nummerierung der Bestellschritte in den Design-Einstellungen (<<bild-bestellschritte-callisto-light>>). In diesem Fall wird in der Variablen *$_id* also die ID der Kategorie gespeichert, die dem 4. Bestellschritt zugeordnet ist. In <<bild-bestellschritte-callisto-light>> ist diese ID die ID 109. In Zeile 8 erhält das Attribut *data-plenty-checkout-content* den Wert, der in *$_id* hinterlegt ist. Der Ausdruck *data-plenty-checkout-content="$_id"* wird also zu *data-plenty-checkout-content="109"*. Mit dem Ausdruck *CategoryContentBody($_id)* wird in Zeile 13 der in der Kategorie *Bestelldetails* hinterlegte Inhalt abgerufen.

[source,plenty]
----
include::assets/EX-DE-IndividuellerBestellvorgang-02.html[]

----

_Codebeispiel 2: Bestellschritte der Kategorie Kasse_

=== Zusätzliche Seiten

Im Individuellen Bestellvorgang ist es möglich, neben den zehn Bestellschritten die folgenden fünf weiteren Seiten über Kategorien selbst zu gestalten:

* Login
* Logout
* Kundenregistrierung
* Passwort vergessen
* Bestellbestätigung

== Inhalte der Bestellschritte

Die HTML-Struktur der einzelnen Bestellschritte des Individuellen Bestellvorgangs wird über globale Template-Funktionen geladen. Diese Template-Funktionen liefern das Grundgerüst, mit dessen Hilfe Bestelldaten dargestellt werden. Durch das Einsetzen von REST-Calls findet ein ständiger Austausch von Bestelldaten zwischen Client und Server statt. Dies stellt eine aktuelle und innerhalb der Bestellschritte konsistente Datenbasis sicher.

Im Template *PageDesignPrepareMainColumn* wird festgelegt, welche Elemente in den Bestellschritten geladen werden sollen.

=== HTML-Gerüst

Die Checkout-Templates zur Darstellung von Bestelldaten in den Bestellschritten bestehen aus HTML-Code, der für die Strukturierung des Inhalts der Bestellschritte sorgt. Die Templates befinden sich im Menü *CMS » Webdesign » Layout » Checkout*. In <<tabelle-checkout-templates>> sind Bestellschritte mit den verwendeten Checkout-Templates aufgelistet. Im Bestellschritt *Warenkorb* wird beispielsweise mit der Anweisung *Container_CheckoutBasketItemsList()* das HTML-Gerüst für die Artikelübersicht im Warenkorb geladen. Das Template findest du unter *CMS » Webdesign » Layout » Checkout » CheckoutBasketItemsList*.

[[tabelle-checkout-templates]]
.Verfügbare Checkout-Templates
[cols="1,3"]
|====
|Kategorie |Container

|*Warenkorb*
|Container_CheckoutBasketItemsList() +
Container_CheckoutTotals() +
Container_CheckoutCoupon()

|*Bestelldetails*
|Container_CheckoutCoupon()

|*Anschrift*
|Container_CheckoutCustomerInvoiceAddress() +
Container_CheckoutCustomerShippingAddress()

|*Zahlung &amp; Versand*
|Container_CheckoutMethodsOfPaymentList() +
Container_CheckoutShippingProfilesList()

|*Bestellübersicht &amp; Kaufabschluss*
|Container_CheckoutMethodsOfPaymentList() +
Container_CheckoutShippingProfilesList()
|====


=== Laden einzelner Elemente

Im Template *PageDesignPrepareMainColumn* unter *CMS » Webdesign » Layout » PageDesign* werden globale Variablen mit Hilfe der Template-Funktion <<omni-channel/online-shop/webshop-einrichten/cms-syntax#webdesign-pagedesign-setglobal, setGlobal>> festgelegt. Du nimmst auf diese Weise Einfluss auf die Sichtbarkeit von Elementen, z.B. den Eingabefeldern von Formularen. Mit den Angaben unter dem Kommentar *# CHECKOUT VALIDATION &amp; APPEARANCE* regelst du die Darstellung von Elementen im Individuellen Bestellvorgang (Tab. 6).

.Template-Funktionen für die Bestelldetails
[cols="1,3,3"]
|====
|Funktion |Standard-Wert |Erklärung

|*SetGlobal("ShowTabDetails", true);*
|true
|Tab *Bestelldetails* wird in Kopfzeile *Kasse* angezeigt.

|*SetGlobal("ShowCustomerSign", true);*
|true
|Zeigt das Eingabefeld *Ihr Zeichen*.

|*SetGlobal("ValidateCustomerSign", false);*
|false
|Validiert das Eingabefeld *Ihr Zeichen*.

|*SetGlobal("ShowCustomerNotice", true);*
|true
|Zeigt das Eingabefeld *deine Hinweise &amp; Sonderwünsche*.

|*SetGlobal("ShowCouponInDetails", true);*
|true
|Zeigt das Eingabefeld *Gutschein-Code*.
|====


=== Ausgabe der Zahlungsarten

Im Ordner deines Designs (z.B. callisto_light_3) in der Kategorie *Zahlung &amp; Versand* wird die globale Funktion *Container_CheckoutMethodsOfPaymentList* aufgerufen. Um alle verfügbaren <<payment/zahlungsarten-verwalten#, Zahlungsarten>> auszugeben, wird in *Callisto Light* das Template *CheckoutMethodsOfPaymentList* in *CMS » Webdesign » Layout » Checkout* verwendet. Es wird eine HTML-Liste mit Optionsfeldern erzeugt, über die Kunden eine Zahlungsart auswählen können (Codebeispiel 3).

[source,plenty]
----
include::assets/EX-DE-IndividuellerBestellvorgang-03.html[]

----

_Codebeispiel 3: Template *CheckoutMethodsOfPaymentList*_

Beim Auswählen der Zahlungsart wird ein change-Event ausgelöst, das sich um die Kommunikation mit dem Server kümmert. Das Event überträgt die vom Kunden ausgewählte Zahlungsart über den Funktionsaufruf *plenty.CheckoutService.setMethodOfPayment*. Die Funktion ist Bestandteil der *plentymarketsCMStools* und führt die REST-Calls für das change-Event aus. Der folgende Code ist ein Ausschnitt des Templates *CheckoutMethodsOfPayment* und zeigt das change-Event mit dem Funktionsaufruf *plenty.CheckoutService.setMethodOfPayment*.

[source,plenty]
----
include::assets/EX-DE-IndividuellerBestellvorgang-04.html[]

----

_Codebeispiel 4: Change-Event im Template *CheckoutMethodsOfPayment*_

== Prüfung der Bestelldaten

Mit den Validatoren des plentymarkets CMS werden die Eingaben deiner Kunden im Bestellprozess auf Richtigkeit geprüft. Alle eingegebenen Daten werden vom Server validiert, bevor die Daten in der Datenbank abgelegt werden. Beispielsweise werden E-Mail-Adressen auf die Richtigkeit ihres Formats hin untersucht und Eingabefelder wie Straße und Hausnummer auf sinnvolle Ziffern- oder Buchstabenfolgen geprüft. Die Validatoren findest du in deinem plentymarkets System unter *CMS » Webdesign » Layout » Validator*. Folgende Validatoren sind für den Bestellvorgang relevant:

.Validatoren für den Bestellvorgang
[cols="1,3"]
|====
|Validator-Template |Erläuterung

|*ValidatorCustomerInvoiceAddress*
|Validiert Eingaben für die Rechnungsadresse.

|*ValidatorCustomerShippingAddress*
|Validiert Eingaben für die Lieferanschrift.

|*ValidatorPlaceOrder*
|Validiert Eingaben für den letzten Bestellschritt *Übersicht &amp; Vertragsabschluss*.
|====


Im Template *ValidatorPlaceOrder* wird unter anderem geprüft, ob Checkboxen für Allgemeine Geschäftsbedingungen (AGB), Datenschutzerklärung oder Newsletter gesetzt sind. In den Templates der Validatoren kann eingestellt werden, welche Daten überprüft werden sollen und welche Meldungen im Fehlerfall angezeigt werden. Nachfolgender Code prüft, ob bei den Allgemeinen Geschäftsbedingungen (engl. Terms and Conditions) vom Kunden ein Haken in der Checkbox gesetzt wurde. Bei gesetztem Häkchen wird der Boolean *$TermsAndConditionsCheck* auf den Wert 1 gesetzt. Mit dem Aufruf *AddError(16)* wird dafür gesorgt, dass im Fehlerfall, also *$TermsAndConditionsCheck!= 1*, die Meldung mit dem Fehlercode 16 ausgegeben wird.

[source,plenty]
----
include::assets/EX-DE-IndividuellerBestellvorgang-05.html[]

----

_Codebeispiel 5: Template *ValidatorPlaceOrder*_

[#10000]
== Google reCAPTCHA für Kundenregistrierung einrichten

Richte Google reCAPTCHA für die Kundenregistrierung im Webshop ein. Registriere deinen Webshop zunächst für die Verwendung von link:https://www.google.com/recaptcha/admin#list[Google reCAPTCHA^]. Gib anschließend den Websiteschlüssel und den Geheimen Schlüssel für deinen Webshop ein.

[.instruction]
Google reCAPTCHA einrichten:

. Öffne das Menü *Einrichtung » Mandant » Mandant wählen » Webshop » Einstellungen*.
. Wähle *Ja* unter *Google reCAPTCHA in Registrierung abfragen*.
. Gib den *Google reCAPTCHA Websiteschlüssel* ein.
. Gib den *Google reCAPTCHA Geheimer Schlüssel* ein.
. *Speichere* (icon:save[role="green"]) die Einstellungen.

[#10010]
=== Kategorie Kundenregistrierung anpassen

Füge anschließend die Template-Funktion `GetCaptcha()` sowie das nachfolgende Code-Beispiel in der Kategorie *Registrierung* ein.

[TIP]
.Parameter für die Funktion GetCaptcha()
====
Folgende Parameter stehen dir für die Funktion `GetCaptcha()` zur Verfügung:

- `GetCaptcha('normal')`: Standardwert für das normale Google reCAPTCHA.
- `GetCaptcha('compact')`: Parameter für das kompakte Google reCAPTCHA.
- `GetCaptcha('invisible')`: Parameter für das unsichtbare Google reCAPTCHA.
====

[.instruction]
Kategorie *Kundenregistrierung* für normales oder kompaktes Google reCAPTCHA anpassen:

. Öffne das Menü *Artikel » Kategorien*.
. Öffne den Ordner des Designs, das du bearbeiten möchtest, z.B. Callisto Light 3.
. Öffne die Kategorie *Registrierung*.
. Wechsle in das Tab *Beschreibung 1*.
. Füge die Template-Funktion `{% GetCaptcha('normal') %}` bzw. `{% GetCaptcha('compact') %}` oberhalb der Schaltfläche *Registrierung abschließen* ein.
. Suche den Code `plenty.AuthenticationService.registerCustomer();`.
. Ersetze den Code durch `registration();`.
. Suche nach `<script>`.
. Füge innerhalb des Script-Bereichs das folgende Code-Beispiel ein.
. *Speichere* (icon:save[role="green"]) die Einstellungen.

----
function registration(){
    var res = plenty.AuthenticationService.registerCustomer();

    if(typeof res !== 'undefined'){

        if(res.status == 400 && typeof grecaptcha !== 'undefined'){
            grecaptcha.reset();
        }

    }
    return false;
}
----

[.instruction]
Kategorie *Kundenregistrierung* für unsichtbares Google reCAPTCHA anpassen:

. Öffne das Menü *Artikel » Kategorien*.
. Öffne den Ordner des Designs, das du bearbeiten möchtest, z.B. Callisto Light 3.
. Öffne die Kategorie *Registrierung*.
. Wechsle in das Tab *Beschreibung 1*.
. Füge die Template-Funktion `{% GetCaptcha('invisible') %}` oberhalb der Schaltfläche *Registrierung abschließen* ein.
. Suche den Code `plenty.AuthenticationService.registerCustomer();`.
. Ersetze den Code durch `grecaptcha.execute();`.
. Suche nach `<script>`.
. Füge innerhalb des Script-Bereichs das folgende Code-Beispiel ein.
. *Speichere* (icon:save[role="green"]) die Einstellungen.

----
function registration(){
    var res = plenty.AuthenticationService.registerCustomer();

    if(typeof res !== 'undefined'){

        if(res.status == 400 && typeof grecaptcha !== 'undefined'){
            grecaptcha.reset();
        }

    }
    return false;
}
----

[#10020]
== Google reCAPTCHA für Gastbestellung einrichten

Du kannst Google reCAPTCHA auch für Gastbestellungen im Webshop einrichten.

[#10030]
=== CheckoutCustomerInvoiceAddress anpassen

Nimm dafür zunächst Änderungen am Template *CheckoutCustomerInvoiceAddress* vor.

[.instruction]
CheckoutCustomerInvoiceAddress für normales oder kompaktes Google reCAPTCHA anpassen:

. Öffne das Menü *CMS » Webdesign » Layout » Checkout » CheckoutCustomerInvoiceAddress*.
. Suche nach `</form>`.
. Füge die Template-Funktion `{% GetCaptcha('normal') %}` oder `{% GetCaptcha('compact') %}` oberhalb des `</form>`-Tags ein.
. *Speichere* (icon:save[role="green"]) die Einstellungen.

[.instruction]
CheckoutCustomerInvoiceAddress für unsichtbares Google reCAPTCHA anpassen:

. Öffne das Menü *CMS » Webdesign » Layout » Checkout » CheckoutCustomerInvoiceAddress*.
. Suche nach `</form>`.
. Füge die Template-Funktion `{% GetCaptcha('invisible') %}` oberhalb des `</form>`-Tags ein.
. *Speichere* (icon:save[role="green"]) die Einstellungen.

[#10040]
=== Kategorie Anschrift anpassen

Passe  anschließend die Kategorie *Anschrift* an.

[.instruction]
Kategorie *Anschrift* für normales oder kompaktes Google reCAPTCHA anpassen:

. Öffne das Menü *Artikel » Kategorien*.
. Öffne den Ordner des Designs, das du bearbeiten möchtest, z.B. Callisto Light 3.
. Öffne die Kategorie *Anschrift*.
. Wechsle in das Tab *Beschreibung 1*.
. Suche den Code `plenty.CheckoutService.registerGuest().done(function()`.
. Ersetze den 4-zeiligen Code-Block durch das nachfolgende Code-Beispiel.
. *Speichere* (icon:save[role="green"]) die Einstellungen.

----
plenty.CheckoutService.registerGuest().done(function() {
    // change tab if success
    plenty.NavigatorService.continueChange( targetContainer );

    }).fail(function(){

    if(typeof grecaptcha !== 'undefined'){
        grecaptcha.reset();
    }

});
----

[.instruction]
Kategorie *Anschrift* für unsichtbares Google reCAPTCHA anpassen:

. Öffne das Menü *Artikel » Kategorien*.
. Öffne den Ordner des Designs, das du bearbeiten möchtest, z.B. Callisto Light 3.
. Öffne die Kategorie *Anschrift*.
. Wechsle in das Tab *Beschreibung 1*.
. Suche den Code `plenty.CheckoutService.registerGuest().done(function()`.
. Ersetze den Code durch `grecaptcha.execute();`.
. Suche nach `<script>`.
. Füge innerhalb des Script-Bereichs das folgende Code-Beispiel ein.
. *Speichere* (icon:save[role="green"]) die Einstellungen.

----
function registration() {

    plenty.CheckoutService.registerGuest().done(function() {
    // change tab if success

        var targetContainer = {id:"shipping-payment", index:2};

        plenty.NavigatorService.continueChange(targetContainer);


    }).fail(function(){

        if(typeof grecaptcha !== 'undefined'){
            grecaptcha.reset();
        }

    });

}
----
