= Best Practice: SSL-Zertifikat bestellen
:lang: de
:keywords: SSL, Let's_Encrypt, let's_enrypt, Lets_Encrypt, lets_encrypt, COMODO, comodo
:position: 1

== Wissenswertes über die SSL-Zertifizierung

=== Preis-Modell der SSL-Zertifizierung

Für das Bereitstellen des SSL-Zertifikates wird eine *mtl. Gebühr in Höhe 2,- € netto zzgl. der Kosten des SSL-Zertifikats* erhoben.

image::basics/admin-aufgaben/best-practices/assets/monatlichen_kosten.png[monatlichen_kosten]

Demnach ergeben sich folgende jährliche Kosten je Modell in aufsteigender Reihenfolge:

[options="header,footer"]
|===
|Zertifikat     |Berechnung     | Kosten p.a.
|Let's Encrypt  | 12*2 + 12*0   | 24,- €
|COMODO 2 Jahre | 12*2 + 1*59,50/2 | 53,75 €
|COMODO 1 Jahr  | 12*2 + 1*35,70   | 59,70 €
|===

TIP: Alle Preise sind in *netto* angegeben.

=== Let’sEncrypt oder COMODO - Welches Zertifikat soll ich nutzen?

==== Pro Let’sEncrypt

* Günstigstes SSL-Zertifizierungsmodell
* Voll automatisierte Verlängerung

==== Contra Let’sEncrypt

* Die Vertrauenswürdigkeit wird im Hintergrund von der kleinen link:https://de.wikipedia.org/wiki/Zertifizierungsstelle[Zertifizierungsstelle]  (Certification Authority - kurz: CA) link:https://www.identrust.com[IdenTrust] bescheinigt – es handelt sich um keine traditionelle CA, sondern um ein Zertifikate ausstellendes Bank-Konsortium.

Offizielle Homepage: link:https://letsencrypt.org/[]

'''

==== Pro COMODO

* Weltweit anerkannte und über Jahre vertrauensvolle link:https://de.wikipedia.org/wiki/Zertifizierungsstelle[CA].
* Im Falle eines Missbrauchs oder Datenverlustes besteht Garantieanspruch bei der ausstellenden CA.

==== Contra COMODO

* Keine automatische Verlängerung
* Zwingend strikte Einhaltung des Beschriebenen Bestellvorgangs notwendig
* Das E-Mail-Postfach *hostmaster*@deineDomain.tld muss angelegt und abrufbar sein

Offizielle Homepage: link:https://comodosslstore.com/[]

=== Domainvoraussetzungen

Die Domain, für die das SSL-Zertifikat bestellt werden soll, muss eine im Service-Center aktivierte Hauptdomain sein (link:https://knowledge.plentymarkets.com/basics/arbeiten-mit-plentymarkets/plentymarkets-konto#_systemverkn%C3%BCpfung_erstellen[Handbuch: Systemverknüpfung erstellen]). +
Siehe *Service Center » Systeme » PID » Tab: Domain » Domain-ID » Systemverknüpfung* +
image::basics/admin-aufgaben/best-practices/assets/systemverknüpfung_hauptdomain.png[systemverknüpfung_hauptdomain]

Die Bestellung eines SSL-Zertifikats *ist nicht möglich*, wenn für die entsprechende Domain unter dem Menüpunkt Systemverknüpfung die Auswahl externer Server abgespeichert ist. +
image::basics/admin-aufgaben/best-practices/assets/externer_server.png[externer_server]

==== Aktiviertes Autoscaling

Vereinzelt gibt es noch immer Systeme, die nicht auf link:https://aws.amazon.com/de/autoscaling/[Autoscaling] (kurz: *AS*) umgestellt wurden. In den meisten Fällen liegt das daran, dass die Domain nicht bei plentymarkets gehostet wird und aus diesem Grund ein manuelles Eingreifen in die DNS-Einstellungen der Domain durch den Domain-Inhaber notwendig ist. +
Eine weitere Ursache ist das *erstmalige* Hinzufügen einer Domain an einen Mandanten-Shop. Diese werden nicht automatisch auf AS umgestellt, sondern müssen von uns im Nachhinein umgestellt werden.

===== Woran erkenne ich aktiviertes AS?

Ob für das jeweilige System AS aktiviert ist oder nicht erkennt man anhand der dargestellten DNS-Einstellungen im Service-Center an der jeweiligen Domain. Systeme, die auf AS umgestellt wurden, benötigen zwingend einen CNAME-Record. Wenn dieser CNAME-Record im Service-Center nicht dargestellt wird, sondern stattdessen zwei A-Records, ist das System, bei dem zwei A-Records dargestellt werden, nicht auf AS umgestellt.

* Beispiel der dargestellten DNS-Einstellungen bei einem System auf AS: +

image::basics/admin-aufgaben/best-practices/assets/identify_set_as.png[DNS-Einstellungen bei aktiviertem AS]

* Beispiel der dargestellten DNS-Einstellungen bei einem System *ohne* AS: +

image::basics/admin-aufgaben/best-practices/assets/identify_non_set_as.png[DNS-Einstellungen bei nicht aktiviertem AS]

==== Bei Subdomains: Existierende Parent-Domain

Wenn ein SSL-Zertifikat für Sub-Domains bestellt werden soll, muss sichergestellt sein, dass die dazugehörige link:https://de.wikipedia.org/wiki/Domain_(Internet)[Parent-Domain] ebenfalls im Service-Center existiert und die notwendige Beziehung zueinander korrekt eingetragen ist.
Solltet ihr die Parent-Domain bereits aus dem Service-Center entfernt haben, muss diese Parent-Domain erneut angelegt werden und, falls gewünscht, mit einem externen A-Record versehen werden, wenn diese *nicht* auf plentymarkets zeigen soll, sondern z.B. auf Shopware oder dergleichen (link:https://knowledge.plentymarkets.com/basics/arbeiten-mit-plentymarkets/plentymarkets-konto#_systemverkn%C3%BCpfung_erstellen[Handbuch: Systemverknüpfung erstellen]). +
Erläutertes Fallbeispiel im Forum: link:https://forum.plentymarkets.com/t/ssl-verlaengerung-nicht-moeglich/501453/4?u=marvin.moldenhauer[SSL Verlängerung nicht möglich]

==== DNS-Einstellungen

===== DNS-Einstellungen gem. Angaben im Service-Center

Die Validierung der SSL-Bestellung erfolgt auf Dateiebene.
Das bedeutet, dass die Domain, für die das Zertifikat bestellt werden soll, zwingend korrekt erreichbar sein muss. Dazu müssen die DNS-Einstellungen gem. den Angaben im Service-Center entsprechen. +
Siehe dazu link:https://forum.plentymarkets.com/t/selbsthilfe-bei-dns-problemen-wie-hinterlege-ich-korrekte-dns-einstellungen/65559[Selbsthilfe bei DNS-Problemen / Wie hinterlege ich korrekte DNS-Einstellungen]

===== Kein AAAA-Record

Für die Domain, für die das SSL-Zertifikat bestellt werden soll, darf kein IPv6-Eintrag (AAAA-Record) existieren.

===== Kein negativer CAA-Record

Für die Domain, für die das SSL-Zertifikat bestellt werden soll, muss sichergestellt werden, dass evtl. vorhandene link:https://de.wikipedia.org/wiki/DNS_Certification_Authority_Authorization[CAA-Records] die Bestellung von COMODO und/oder LetsEncrypt-Zertifikaten zulässt.

=== Veröffentlichung / Bereitstellung

Nach Bestellung eines neuen Zertifikats muss dieses durch einen regelmäßig ausgeführten *Systemprozess* veröffentlicht werden. *Dies kann bis zu 60 Minuten dauern.*

=== Qualitätskontrolle durch die Zertifizierungsstelle

In Einzelfällen führt die Zertifizierungsstelle eine Qualitätskontrolle durch bevor sie SSL-Zertifikate freischaltet. Prüfe daher die auf dem Bildschirm angezeigte Bestätigungsnachricht. Eine Qualitätskontrolle dauert in der Regel bis zu 24 Stunden. Sollte der Status im Service-Center nach 24 Stunden nicht *done* lauten, melde Dich im Forum unter Angabe der betroffenen Domain.

=== Gültigkeitsdauer

==== Gültigkeitsdauer für Let’sEncrypt-Zertifikate

* SSL-Zertifikate von *Let’sEncrypt* sind jeweils *90 Tage* gültig.
* Alle *60 Tage* wird das Zertifikat *erneuert.*

[options="header,footer"]
|===
|Ausstellungsdatum  |gültig bis | Erneuerungsdatum
|01.01.18           | 01.04.18  | 02.03.18
|02.03.18           | 31.05.18  | 01.05.18
|01.05.18           | 30.07.18  | 30.06.18
|30.06.18           | 28.09.18   | 29.08.18
|29.08.18           | 27.11.18	| 28.10.18
|28.10.18           | 26.01.19	| 27.12.18
|27.12.18           | 27.03.19	| 25.02.19
|===

===== Let’sEncrypt kündigen

Die Kündigung des Let’sEncrypt-Zertifikats sorgt dafür, dass keine Erneuerung stattfindet.
Die Laufzeit des aktuell ausgestellten Zertifikats wird dadurch nicht beeinflusst.
[options="header,footer"]
|===
|Ausstellungsdatum  |gültig bis | Erneuerungsdatum
|01.01.18           | 01.04.18  | 02.03.18
|02.03.18           | 31.05.18  | 01.05.18
|===

====== Kündigung am 18.05.2018

Die letzte Erneuerung des SSL-Zertifikats fand am 01.05.2018 statt. Demnach ist das SSL-Zertifikat ab dem Datum 90 Tage gültig. Nach Ablauf der 90 Tage wird die entsprechende Domain nicht mehr per HTTPS ausgeliefert und wird demnach als _Nicht sicher_ eingestuft.

[options="header,footer"]
|===
|Ausstellungsdatum  |gültig bis | Erneuerungsdatum
|01.05.18           | 30.07.18  | entfällt wg. Kündigung
|===

image::basics/admin-aufgaben/best-practices/assets/ssl-zertifikat_deaktivieren.png[ssl-zertifikat_deaktivieren]

==== Gültigkeitsdauer für COMODO-Zertifikate

Die Gültigkeitsdauer von neu bestellten Zertifikaten beginnt mit dem Datum der Bestätigung der Zertifizierungsstelle. Eine eventuelle Restlaufzeit des vorherigen Zertifikats kann nicht übernommen werden.

Die Laufzeit des SSL-Zertifikats wird während des Bestellprozesses zur Auswahl gestellt:

* 1 Jahr
* 2 Jahre

=== Verlängerung des SSL-Zertifikats

==== Verlängerung für Let’sEncrypt-Zertifikate

Die Verlängerung der Let’sEncrypt-SSL-Zertifikate findet vollautomatisch statt, bis es im Service-Center durch das Entfernen des Hakens gekündigt wird.

==== Verlängerung für COMODO-Zertifikate

Ein von COMODO ausgestelltes SSL-Zertifikat verlängert sich *nicht automatisch*
→ Es muss nach Ende der Laufzeit (mindestens 1 Jahr) neu geordert werden.

14 Tage vor offiziellem Ablaufdatum des Zertifikats (siehe Service-Center) wird eine Erinnerungs-E-Mail an die Hostmaster-Adresse gesendet.

Zusätzlich besteht die Möglichkeit, sich per E-Mail erinnern zu lassen. Eine kostenfreie Möglichkeit stellt der Dienst http://letsmonitor.org/ dar.

=== Gekündigte Domains und Testdomains

Für bereits *_gekündigte_* Domains, sowie für *_Startup-Domains_* bzw. *_Test-Subdomains_* (d.h. Domains mit den Bestandteilen _plenty-test-drive.eu, plentymarkets-x1.com, plentymarkets-cloud01/02.com_ etc.,) können *_keine SSL-Zertifikate bestellt* werden_*.

=== Domainvalidierte/-bezogene Zertifikate

SSL-Zertifikate sind domaingebunden. Das bedeutet, dass beispielsweise bei Umstellung der Hauptdomain das aktuelle Zertifikat _inaktiv_ geschaltet wird, da eine neue Hauptdomain ohne bestelltes Zertifikat vorliegt.
Inaktiv bedeutet nicht gelöscht - Sollte die Hauptdomain erneut auf die Domain umgestellt werden, die bereits ein SSL-Zertifikat besaß, kann dieses im Service Center wieder aktiviert werden, sofern das SSL-Zertifikat noch gültig ist.

=== Domainumzug, PKI, SSL-Zertifikat verschieben / transferieren

SSL-Zertifikate können bei einem Domainumzug zu plentymarkets *nicht* mitgenommen werden. Aufgrund der technischen Gegebenheiten ist die Bestellung nur innerhalb unserer link:https://de.wikipedia.org/wiki/Public-Key-Infrastruktur[Public-Key-Infrastruktur] möglich.

Dies gilt für *_beide Richtungen_*. Sowohl von *_extern zu plentymarkets_*, als auch von *_plentymarkets zu extern_*. Ein über plentymarkets gebuchtes SSL-Zertifikat muss *_systemnah_* liegen und kann bei einem Domaintransfer nicht mitgenommen werden. Ein Export der Zertifikatsdaten (geheimer Private-Key) ist *nicht* möglich. Auch ein “Transfer” eines SSL-Zertifikats von einer Domain(-ID) auf eine andere ist nicht möglich (siehe Punkt <<Veröffentlichung / Bereitstellung>>).

CAUTION: Um die gewünschte Domain mit einem gültigen SSL-Zertifikat auszuliefern, siehe ab <<Schritt für Schritt zum SSL-Zertifikat>>.

=== Wildcard-Zertifikate

Das Ausstellen von sogenannten Wildcard-SSL-Zertifikaten ist in unserer Infrastruktur nicht möglich.

== Schritt für Schritt zum SSL-Zertifikat

=== SSL-Zertifikat von Let’sEncrypt

==== Wie gelange ich zum Bestellvorgang?

Logge Dich über dein Backend oder den folgenden Link in Dein Service-Center ein: https://www.plentymarkets.eu/my-account/

Für den Login benötigst Du die E-Mail-Adresse, die Du auf Deiner Rechnung findest und das dazugehörige Passwort. Wenn Du das Passwort nicht (mehr) kennst, benutze die Funktion zum Zurücksetzen des Passworts.

==== Wie bestelle ich erfolgreich ein SSL-Zertifikat von Let’sEncrypt?

IMPORTANT: Es ist zwingend notwendig, dass die DNS-Einstellungen der Domain, für die das SSL-Zertifikat bestellt werden soll, den Angaben in Deinem Service-Center entsprechen - siehe auch link:https://forum.plentymarkets.com/t/selbsthilfe-bei-dns-problemen-wie-hinterlege-ich-korrekte-dns-einstellungen/65559[Selbsthilfe bei DNS-Problemen / Wie hinterlege ich korrekte DNS-Einstellungen].

image::basics/admin-aufgaben/best-practices/assets/ssl-zertifikat_bestellen.png[ssl-zertifikat_bestellen]

==== Wann ist die Bestellung erfolgreich abgeschlossen?
* Nach ca. 1 - 2 Stunden sollte das Zertifikat korrekt installiert sein.
* Browser- und ggf. DNS-Cache leeren: link:https://forum.plentymarkets.com/t/loeschen-des-lokalen-browser-und-oder-dns-cache/64288[Löschen des lokalen Browser- und/oder DNS-Cache]

Die Bestellung des LetsEncrypt-Zertifikates ist erst abgeschlossen, wenn der Status im Service Center auf **“done”** steht. Alle Meldungen, die **“challenge…”** beinhalten bedeuten, dass der Bestellvorgang noch bearbeitet wird.

=== SSL-Zertifikat von COMODO

==== Wie gelange ich zum Bestellvorgang?

Wenn Du sichergestellt hast, dass sämtliche in §1.3 genannten Voraussetzungen erfüllt sind, kannst Du mit der Bestellung des SSL-Zertifikats fortfahren.

Logge Dich dazu in Dein Backend ein und navigiere zu: +
**System » Systemeinstellungen » Mandant » [Mandant, für den das SSL-Zertifikat bestellt werden soll] » SSL**

Dort angekommen siehst Du nun die nachfolgende Übersicht:

image::basics/admin-aufgaben/best-practices/assets/comodo_ssl_bestellen_backend1.png[Backend_navigate_to_ssl_order1]

Klicke auf *Neues SSL bestellen für Domain: `[deineDomain.tld]`*, um die Bestellauswahl anzuzeigen:

image::basics/admin-aufgaben/best-practices/assets/comodo_ssl_bestellen_backend2.png[Backend_navigate_to_ssl_order2]

1. *SSL bestellen* klicken
2. nach ca. 1 - 2 Stunden sollte das Zertifikat korrekt installiert sein
3. Browser- und ggf. DNS-Cache leeren: link:https://forum.plentymarkets.com/t/loeschen-des-lokalen-browser-und-oder-dns-cache/64288[Löschen des lokalen Browser- und/oder DNS-Cache]

== Was kann bei der Bestellung schiefgehen?

=== Der Status der Bestellung steckt fest bei `challengeSolved`
Bitte unbedingt überprüfen, ob *alle* genannten Voraussetzungen zum erfolgreichen Bestellen eines SSL-Zertifikats erfüllt sind.

Wenn die Voraussetzungen alle erfüllt sind und der Status der Bestellung dennoch festhängt im Status _challengeSolved_, bitte ich darum euch in dem nachfolgenden Beitrag zu melden, damit wir den Sachverhalt auf unserer Seite überprüfen können:
link:https://forum.plentymarkets.com/t/letsencrypt-bestellung-haengt-im-status-challengesolved/518542[Link zum plentymarkets Forum]

== Häufig gestellte Fragen (FAQ)

[qanda]
*Ich habe LetsEncrypt bereits vor mehreren Stunden bestellt, meine Seite wird aber noch immer nicht als sicher eingestuft - Was kann ich machen?*::
.. *Option 1:* Nachdem die Bestellung im Service-Center der Status “done” erhalten hat muss der lokale Browser-Cache geleert werden (link:https://forum.plentymarkets.com/t/loeschen-des-lokalen-dns-cache/64288[Löschen des lokalen Browser- und/oder DNS-Cache]), damit das zwischengespeicherte Zertifikat aktualisiert wird.
.. *Option 2:* Evtl. liegt bei der Erreichbarkeit Deiner Domain ein Problem vor und das Zertifikat kann deswegen nicht korrekt ausgeliefert werden. Du kannst auf der nachfolgenden Seite prüfen, ob eine Installation von LetsEncrypt für Deine Domain möglich ist: https://letsdebug.net/ >> *Validation method: HTTP-01*. Falls dort eine Fehlermeldung ausgegeben wird kannst Du uns diese gern im Forum mitteilen, damit wir den Sachverhalt prüfen können.

*Ich möchte von COMODO auf LetsEncrypt umsteigen - was ist zu beachten?*::
.. Im Falle einer Bestellung von Let’sEncrypt bei einem bereits aktiven SSL-Zertifikat von COMODO (alias RapidSSL), wird das COMODO-Zertifikat durch das von Let’sEncrypt ersetzt! Das “alte” Zertifikat wird jedoch nicht gelöscht, sondern auf inaktiv geschaltet. Eine Reaktivierung innerhalb des Gültigkeitszeitraums ist durch @plenty-Cloud möglich. Es kann sein, dass die Domain für maximal 1h als “nicht sicher” eingestuft wird, wenn das LetsEncrypt-Zertifikat gerade erst bestellt wurde, da dies nach der Bestellung angefordert, generiert und installiert werden muss. Nachdem die Bestellung im Service-Center der Status “done” erhalten hat muss der lokale Browser-Cache geleert werden, damit das zwischengespeicherte Zertifikat aktualisiert wird.
