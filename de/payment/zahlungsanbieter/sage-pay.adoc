= Alter Webshop: Sage Pay
:lang: de
include::{includedir}/_header.adoc[]
:keywords: Sage Pay, Zahlungsart
:description: Payment in plentymarkets: Richte die Schnittstelle zu Sage Pay in deinem plentymarkets System ein.
:position: 210
:url: payment/zahlungsanbieter/sage-pay
:id: 30W7BE5

[IMPORTANT]
.Einrichtung der Schnittstelle nur in Callisto Shops
====
Diese Handbuchseite beschreibt ausschließlich die Einrichtung der Schnittstelle *Sage Pay* in Callisto Shops. Die folgenden Anleitungen sind somit nicht für Ceres Shops gültig!
====

link:http://www.sagepay.co.uk/[Sage Pay^] (nur Englisch) ist ein Zahlungsanbieter, der in Großbritannien gegründet wurde und im Vereinigten Königreich und Irland verfügbar ist. Sage Pay bietet verschiedene Zahlungsmöglichkeiten, ein integriertes Betrugspräventionstool und z.B. Transaktionsberichte.

[#10]
== Wichtige Hinweise

In diesem Kapitel erhältst du wichtige Hinweise zur Integration von Sage Pay in plentymarkets.

[#20]
=== Bezahlvorgang

Nach dem Bestätigen der Bestellung wird der Kunde auf eine Seite von Sage Pay weitergeleitet. Dort muss er die Daten der von ihm gewählten Kreditkarte eingeben. Nachdem die Daten eingegeben wurden und die Zahlung durch den Kunden bestätigt wurde, wird der Kunde wieder zurück in deinen Webshop geleitet.

[#30]
=== Verfügbare Sage Pay-Zahlungsarten

Nachfolgend findest du eine Übersicht der für plentymarkets verfügbaren Sage Pay-Zahlungsarten mit der System-ID in Klammern.

* Sage Pay (Payment)
* Sage Pay deferred
* Sage Pay authenticate

Bei der ersten Zahlungsart wird der Betrag direkt an dich, den Händler, überwiesen. Bei den Zahlungsarten *deferred* und *authenticate* wird der Betrag an dich als Händler überwiesen, nachdem du den Betrag angefordert hast. Eine genaue Erläuterung der verschiedenen Sage Pay-Zahlungsarten findest du bei link:http://www.sagepay.co.uk/support/15/36/transaction-types[Sage Pay^] (nur Englisch).

[#40]
== Bei Sage Pay registrieren

Bevor du Sage Pay in plentymarkets verwenden kannst, musst du dich dort registrieren. Zur Registrierung bei Sage Pay nimmst du link:http://www.sagepay.co.uk/contact[Kontakt^] (nur Englisch) zu Sage Pay auf. Nimm die Registrierung vor, um die Zugangsdaten zu erhalten. Diese benötigst du für die Einrichtung in plentymarkets. Nach der Registrierung musst du in deinem Sage Pay-Konto die IP-Adresse des Servers, auf dem dein Shop läuft, eingeben. Diese Eingabe nimmst du bei Sage Pay unter *Einstellungen » Gültige IPs* vor.

[#50]
== Sage Pay in Callisto einrichten

Gehe wie unten beschrieben vor, um die Schnittstelle zu Sage Pay für deinen Callisto Shop in plentymarkets einzurichten.

[.instruction]
Schnittstelle zu Sage Pay einrichten:

. Öffne das Menü *Einrichtung » Aufträge » Zahlung » Zahlungsarten*.
. Aktiviere die Einstellung *Auch inaktive zeigen*.
. Öffne den Ordner *International*.
.  Klicke auf *Sage Pay*. +
→ Das Tab *Schnittstelle* wird geöffnet.
.  Klappe den Mandanten auf.
.  Nimm die Einstellungen vor. Beachte dazu die Erläuterungen in <<tabelle-schnittstelleneinrichtung-sage-pay>>.
. *Speichere* die Einstellungen.

[[tabelle-schnittstelleneinrichtung-sage-pay]]
.Schnittstelle zu Sage Pay einrichten
[cols="1,3"]
|====
|Einstellung |Erläuterung

|*Händlername*
|Händlernamen eingeben, wie von Sage Pay erhalten.

|*Iframe aktivieren*
|Iframe aktivieren, damit der Kunde nicht länger zu Sage Pay weitergeleitet wird, sondern seine Kreditkartendaten direkt in deinem Shop eingeben kann. +
Deaktivieren, damit der Kunde zu Sage Pay weitergeleitet wird, dort die Kreditkarte wählt und dann die Daten eingibt. +
*_Wichtig:_* Beachte , dass die aktivierte Iframe-Option nicht mit lokalen europäischen Zahlungsarten kompatibel ist.

|*Testbetrieb aktivieren*
|Testbetrieb aktivieren, um die Sage Pay-Funktionen zu testen, bevor mit dem System live gearbeitet wird.

2+|Mandant (Shop)-Optionen

|*Zugangsdaten für alle Mandanten (Shops) aktivieren*
|Nur sichtbar, wenn Mandanten eingerichtet sind. Aktivieren, um die Kontoeinstellungen, die über *Konto hinzufügen* für den Hauptshop gespeichert wurden, für alle Mandanten (Shops) zu übernehmen, unabhängig davon, was für andere Mandanten gespeichert wurde. Deaktivieren, um separate Zugangsdaten für weitere Mandanten (Shops) zu verwenden. Webshops, für die kein Konto hinzugefügt wurde, können mit Sage Pay nicht genutzt werden. +
Zur Unterstützung mehrerer Mandanten muss im Menü <<webshop/webshop-einrichten#grundeinstellungen, Einrichtung » Mandant » Mandant wählen » Webshop » Einstellungen>> für die Option *Login* die Einstellung *Login in jedem einzelnen Shop ermöglichen* aktiviert sein.
|====

[#60]
== Zahlungsart aktivieren

Richte die <<payment/zahlungsarten-verwalten#20, Zahlungsarten>> Sage Pay, Sage Pay deferred und Sage Pay authenticate im Tab *Einstellungen* der Zahlungsarten ein. Prüfe zudem die Einstellungen für *Erlaubte Zahlungsarten* in den <<payment/zahlungsarten-verwalten#30, Kundenklassen>> und für *Gesperrte Zahlungsarten* in den <<fulfillment/versand-vorbereiten#1000, Versandprofilen>>.

[#70]
== Zahlungen autorisieren und stornieren

Nachdem ein Auftrag mit der Zahlungsart Sage Pay in plentymarkets vorliegt, musst du je nach Sage Pay-Zahlungsart und Fortschritt der Zahlung unterschiedlich vorgehen, um die Zahlungen zu autorisieren oder zu stornieren.

[TIP]
.Ereignisaktion für Stornierung
====
Wenn der Status auf *storniert* wechselt, wird mithilfe einer *Ereignisaktion* die Stornierung automatisch an Sage Pay gemeldet, d.h. in dem Fall musst du im Tab *Einstellungen* nicht auf *stornieren* klicken.
====

[#80]
=== Sage Pay Payment stornieren

Bei einem Auftrag, der mit *Sage Pay Payment* bezahlt wurde, ist die Zahlung automatisch gebucht. Um die Zahlung zu stornieren, gehe wie nachfolgend beschrieben vor.

[IMPORTANT]
.Stornierung nur am selben Tag
====
Bei der Zahlungsart *Sage Pay* kann eine Zahlung in plentymarkets nur am selben Tag storniert werden, an dem der Auftrag eingegangen ist. In deinem Sage Pay-Konto kannst du die Zahlung u.U. auch noch später stornieren.
====

[.instruction]
Sage Pay Payment stornieren:

. Öffne das Menü *Aufträge » Aufträge bearbeiten*.
. Öffne den Auftrag, der storniert werden soll. +
→ Das Tab *Übersicht* wird geöffnet.
. Wechsle in das Tab *Einstellungen*.
. Klicke auf *Gebuchte SagePay Zahlung stornieren*.
. Ändere den *Status* des Auftrags zu *storniert*.

Mit einer Ereignisaktion sendest du die <<payment/zahlungsanbieter/sage-pay#110, Stornierung>> an Sage Pay.

[#90]
=== Sage Pay Deferred- oder Authenticate-Zahlung abbrechen

Eine Zahlung, die noch nicht autorisiert oder freigegeben wurde, brichst du wie nachfolgend beschrieben ab.

[.instruction]
Zahlung abbrechen:

. Öffne das Menü *Aufträge » Aufträge bearbeiten*.
. Öffne den Auftrag, bei dem die Zahlung abgebrochen werden soll. +
→ Das Tab *Übersicht* wird geöffnet.
. Wechsle in das Tab *Einstellungen*.
. Klicke auf *SagePay Zahlung abbrechen*. +
→ Die Zahlung wird abgebrochen.

Mit einer Ereignisaktion sendest du die <<payment/zahlungsanbieter/sage-pay#110, Stornierung>> an Sage Pay.

[#100]
=== Sage Pay Deferred- oder Authenticate-Zahlung autorisieren

Um die Zahlung für einen Auftrag zu erhalten, der mit Sage Pay deferred oder authenticate bezahlt wurde, zu erhalten, gehe wie nachfolgend beschrieben vor.

[.instruction]
Zahlung autorisieren:

. Öffne das Menü *Aufträge » Aufträge bearbeiten*.
. Öffne den Auftrag, bei dem die Zahlung autorisiert werden soll. +
→ Das Tab *Übersicht* wird geöffnet.
. Wechsle in das Tab *Einstellungen*.
. Klicke auf *SagePay Zahlung autorisieren / freigeben*. +
→ Die Zahlung wird freigegeben oder autorisiert.

[IMPORTANT]
.Autorisierte oder freigegebene Zahlungen stornieren
====
Sobald eine Zahlung autorisiert oder freigegben wurde, kann sie nur am selben Tag noch storniert werden. Nach der Autorisierung/Freigabe erscheint im Tab *Einstellungen* des Auftrags die Option *Gebuchte SagePay Zahlung stornieren*. Diese muss angeklickt werden, um die Zahlung zu stornieren. +
Anschließend setzt du den Auftrag manuell in den Status *storniert*.
====

[#110]
==  Stornierungen automatisch senden

Richte eine <<automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um Sage Pay automatisch über Stornierungen zu informieren.

[.collapseBox]
.Ereignisaktion einrichten
--
.  Öffne das Menü *Einrichtung » Aufträge » Ereignisse*.
.  Klicke auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
.  Gib einen Namen ein.
.  Wähle das *Ereignis* gemäß Tabelle 2.
. *Speichere* die Einstellungen.
.  Nimm die Einstellungen gemäß Tabelle 2 vor.
.  Setze ein Häkchen bei *Aktiv*.
. *Speichere* die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Stornierungen an Sage Pay
[cols="1,3,3"]
|====
| Einstellung | Option | Auswahl

|*Ereignis*
|*Auftragsänderung: Statuswechsel*
| Status für *stornierte Aufträge* wählen.

|*Filter 1*
|*Auftrag &gt; Auftragstyp*
|*Auftrag*

|*Filter 2*
|*Auftrag &gt; Zahlungsart*
|*Sage Pay*

|*Aktion 1*
|*Zahlungsarten &gt; Stornierung an Sage Pay senden (Alle)*
|

|*Aktion 2*
|*Zahlungsarten &gt; Stornierung an Sage Pay senden (Authenticate)*
|

|*Aktion 3*
|*Zahlungsarten &gt; Stornierung an Sage Pay senden (Deferred)*
|
|====

[TIP]
.Pro Zahlungsart eine Ereignisaktion
====
Erstelle für jede Zahlungsart eine eigene Ereignisaktion, da es sonst zu ungewollten Meldungen kommt. Wenn du im Tab *Filter* mehrere Zahlungsarten wählen, wird die ausgelöste Meldung auch für andere Zahlungsarten und an die dort hinterlegten Zahlungsanbieter geschickt. Wähle unter Aktionen für *Deferred* und *Authenticate* außerdem immer 2 Aktionen.
====

[#120]
== Gutschriften automatisch senden

Wenn du eine Zahlung bereits erhalten hast und dem Kunden das Geld per Gutschrift erstatten möchtest, richte eine <<automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um Gutschriften automatisch an Sage Pay zu senden.

[.collapseBox]
.Ereignisaktion einrichten
--
.  Öffne das Menü *Einrichtung » Aufträge » Ereignisse*.
.  Klicke auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
.  Gib einen Namen ein.
.  Wähle das *Ereignis* gemäß Tabelle 3.
. *Speichere* die Einstellungen.
.  Nimm die Einstellungen gemäß Tabelle 3 vor.
.  Setze ein Häkchen bei *Aktiv*.
. *Speichere* die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Gutschriften an Sage Pay
[cols="1,3,3"]
|====
| Einstellung | Option | Auswahl

|*Ereignis*
|*Auftragsanlage: Neue Gutschrift*
|

|*Filter*
|*Auftrag &gt; Zahlungsart*
|*Sage Pay*

|*Aktion*
|*Zahlungsarten &gt; Gutschrift an Sage Pay senden*
|
|====
