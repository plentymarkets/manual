= Alter Webshop: Sage Pay
:lang: de
include::{includedir}/_header.adoc[]
:keywords: Sage Pay, Zahlungsart
:description: Payment in plentymarkets: Richten Sie die Schnittstelle zu Sage Pay in Ihrem plentymarkets System ein.
:position: 210

[IMPORTANT]
.Einrichtung der Schnittstelle nur in Callisto Shops
====
Diese Handbuchseite beschreibt ausschließlich die Einrichtung der Schnittstelle *Sage Pay* in Callisto Shops. Die folgenden Anleitungen sind somit nicht für Ceres Shops gültig!
====

link:http://www.sagepay.co.uk/[Sage Pay^] (nur Englisch) ist ein Zahlungsanbieter, der in Großbritannien gegründet wurde und im Vereinigten Königreich und Irland verfügbar ist. Sage Pay bietet verschiedene Zahlungsmöglichkeiten, ein integriertes Betrugspräventionstool und z.B. Transaktionsberichte.

[#10]
== Wichtige Hinweise

In diesem Kapitel erhalten Sie wichtige Hinweise zur Integration von Sage Pay in plentymarkets.

[#20]
=== Bezahlvorgang

Nach dem Bestätigen der Bestellung wird der Kunde auf eine Seite von Sage Pay weitergeleitet. Dort muss er die Daten der von ihm gewählten Kreditkarte eingeben. Nachdem die Daten eingegeben wurden und die Zahlung durch den Kunden bestätigt wurde, wird der Kunde wieder zurück in Ihren Webshop geleitet.

[#30]
=== Verfügbare Sage Pay-Zahlungsarten

Nachfolgend finden Sie eine Übersicht der für plentymarkets verfügbaren Sage Pay-Zahlungsarten mit der System-ID in Klammern.

* Sage Pay (Payment)
* Sage Pay deferred
* Sage Pay authenticate

Bei der ersten Zahlungsart wird der Betrag direkt an Sie, den Händler, überwiesen. Bei den Zahlungsarten *deferred* und *authenticate* wird der Betrag an Sie als Händler überwiesen, nachdem Sie den Betrag angefordert haben. Eine genaue Erläuterung der verschiedenen Sage Pay-Zahlungsarten finden Sie bei link:http://www.sagepay.co.uk/support/15/36/transaction-types[Sage Pay^] (nur Englisch).

[#40]
== Bei Sage Pay registrieren

Bevor Sie Sage Pay in plentymarkets verwenden können, müssen Sie sich dort registrieren. Zur Registrierung bei Sage Pay nehmen Sie link:http://www.sagepay.co.uk/contact[Kontakt^] (nur Englisch) zu Sage Pay auf. Nehmen Sie die Registrierung vor, um die Zugangsdaten zu erhalten. Diese benötigen Sie für die Einrichtung in plentymarkets. Nach der Registrierung müssen Sie in Ihrem Sage Pay-Konto die IP-Adresse des Servers, auf dem Ihr Shop läuft, eingeben. Diese Eingabe nehmen Sie bei Sage Pay unter *Einstellungen » Gültige IPs* vor.

[#50]
== Sage Pay in Callisto einrichten

Gehen Sie wie unten beschrieben vor, um die Schnittstelle zu Sage Pay für Ihren Callisto Shop in plentymarkets einzurichten.

[.instruction]
Schnittstelle zu Sage Pay einrichten:

. Öffnen Sie das Menü *System » Aufträge » Zahlung » Zahlungsarten*.
. Aktivieren Sie die Einstellung *Auch inaktive zeigen*.
. Öffnen Sie den Ordner *International*.
.  Klicken Sie auf *Sage Pay*. +
→ Das Tab *Schnittstelle* wird geöffnet.
.  Klappen Sie den Mandanten auf.
.  Nehmen Sie die Einstellungen vor. Beachten Sie dazu die Erläuterungen in <<tabelle-schnittstelleneinrichtung-sage-pay>>.
. *Speichern* Sie die Einstellungen.

[[tabelle-schnittstelleneinrichtung-sage-pay]]
.Schnittstelle zu Sage Pay einrichten
[cols="1,3"]
|====
|Einstellung |Erläuterung

|*Händlername*
|Händlernamen eingeben, wie von Sage Pay erhalten.

|*Iframe aktivieren*
|Iframe aktivieren, damit der Kunde nicht länger zu Sage Pay weitergeleitet wird, sondern seine Kreditkartendaten direkt in Ihrem Shop eingeben kann. +
Deaktivieren, damit der Kunde zu Sage Pay weitergeleitet wird, dort die Kreditkarte wählt und dann die Daten eingibt. +
*_Wichtig:_* Beachten Sie, dass die aktivierte Iframe-Option nicht mit lokalen europäischen Zahlungsarten kompatibel ist.

|*Testbetrieb aktivieren*
|Testbetrieb aktivieren, um die Sage Pay-Funktionen zu testen, bevor mit dem System live gearbeitet wird.

2+|Mandant (Shop)-Optionen

|*Zugangsdaten für alle Mandanten (Shops) aktivieren*
|Nur sichtbar, wenn Mandanten eingerichtet sind. Aktivieren, um die Kontoeinstellungen, die über *Konto hinzufügen* für den Hauptshop gespeichert wurden, für alle Mandanten (Shops) zu übernehmen, unabhängig davon, was für andere Mandanten gespeichert wurde. Deaktivieren, um separate Zugangsdaten für weitere Mandanten (Shops) zu verwenden. Webshops, für die kein Konto hinzugefügt wurde, können mit Sage Pay nicht genutzt werden. +
Zur Unterstützung mehrerer Mandanten muss im Menü <<omni-channel/online-shop/webshop-einrichten#grundeinstellungen, System » Mandant » Mandant wählen » Webshop » Einstellungen>> für die Option *Login* die Einstellung *Login in jedem einzelnen Shop ermöglichen* aktiviert sein.
|====

[#60]
== Zahlungsart aktivieren

Richten Sie die <<payment/zahlungsarten-verwalten#20, Zahlungsarten>> Sage Pay, Sage Pay deferred und Sage Pay authenticate im Tab *Einstellungen* der Zahlungsarten ein. Prüfen Sie zudem die Einstellungen für *Erlaubte Zahlungsarten* in den <<payment/zahlungsarten-verwalten#30, Kundenklassen>> und für *Gesperrte Zahlungsarten* in den <<fulfillment/versand-vorbereiten#1000, Versandprofilen>>.

[#70]
== Zahlungen autorisieren und stornieren

Nachdem ein Auftrag mit der Zahlungsart Sage Pay in plentymarkets vorliegt, müssen Sie je nach Sage Pay-Zahlungsart und Fortschritt der Zahlung unterschiedlich vorgehen, um die Zahlungen zu autorisieren oder zu stornieren.

[TIP]
.Ereignisaktion für Stornierung
====
Wenn der Status auf *storniert* wechselt, wird mithilfe einer *Ereignisaktion* die Stornierung automatisch an Sage Pay gemeldet, d.h. in dem Fall müssen Sie im Tab *Einstellungen* nicht auf *stornieren* klicken.
====

[#80]
=== Sage Pay Payment stornieren

Bei einem Auftrag, der mit *Sage Pay Payment* bezahlt wurde, ist die Zahlung automatisch gebucht. Um die Zahlung zu stornieren, gehen Sie wie nachfolgend beschrieben vor.

[IMPORTANT]
.Stornierung nur am selben Tag
====
Bei der Zahlungsart *Sage Pay* kann eine Zahlung in plentymarkets nur am selben Tag storniert werden, an dem der Auftrag eingegangen ist. In Ihrem Sage Pay-Konto können Sie die Zahlung u.U. auch noch später stornieren.
====

[.instruction]
Sage Pay Payment stornieren:

. Öffnen Sie das Menü *Aufträge » Aufträge bearbeiten*.
. Öffnen Sie den Auftrag, der storniert werden soll. +
→ Das Tab *Übersicht* wird geöffnet.
. Wechseln Sie in das Tab *Einstellungen*.
. Klicken Sie auf *Gebuchte SagePay Zahlung stornieren*.
. Ändern Sie den *Status* des Auftrags zu *storniert*.

Mit einer Ereignisaktion senden Sie die <<payment/sage-pay#110, Stornierung>> an Sage Pay.

[#90]
=== Sage Pay Deferred- oder Authenticate-Zahlung abbrechen

Eine Zahlung, die noch nicht autorisiert oder freigegeben wurde, brechen Sie wie nachfolgend beschrieben ab.

[.instruction]
Zahlung abbrechen:

. Öffnen Sie das Menü *Aufträge » Aufträge bearbeiten*.
. Öffnen Sie den Auftrag, bei dem die Zahlung abgebrochen werden soll. +
→ Das Tab *Übersicht* wird geöffnet.
. Wechseln Sie in das Tab *Einstellungen*.
. Klicken Sie auf *SagePay Zahlung abbrechen*. +
→ Die Zahlung wird abgebrochen.

Mit einer Ereignisaktion senden Sie die <<payment/sage-pay#110, Stornierung>> an Sage Pay.

[#100]
=== Sage Pay Deferred- oder Authenticate-Zahlung autorisieren

Um die Zahlung für einen Auftrag zu erhalten, der mit Sage Pay deferred oder authenticate bezahlt wurde, zu erhalten, gehen Sie wie nachfolgend beschrieben vor.

[.instruction]
Zahlung autorisieren:

. Öffnen Sie das Menü *Aufträge » Aufträge bearbeiten*.
. Öffnen Sie den Auftrag, bei dem die Zahlung autorisiert werden soll. +
→ Das Tab *Übersicht* wird geöffnet.
. Wechseln Sie in das Tab *Einstellungen*.
. Klicken Sie auf *SagePay Zahlung autorisieren / freigeben*. +
→ Die Zahlung wird freigegeben oder autorisiert.

[IMPORTANT]
.Autorisierte oder freigegebene Zahlungen stornieren
====
Sobald eine Zahlung autorisiert oder freigegben wurde, kann sie nur am selben Tag noch storniert werden. Nach der Autorisierung/Freigabe erscheint im Tab *Einstellungen* des Auftrags die Option *Gebuchte SagePay Zahlung stornieren*. Diese muss angeklickt werden, um die Zahlung zu stornieren. +
Anschließend setzen Sie den Auftrag manuell in den Status *storniert*.
====

[#110]
==  Stornierungen automatisch senden

Richten Sie eine <<basics/automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um Sage Pay automatisch über Stornierungen zu informieren.

[.collapseBox]
.Ereignisaktion einrichten
--
.  Öffnen Sie das Menü *System » Aufträge » Ereignisse*.
.  Klicken Sie auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
.  Geben Sie einen Namen ein.
.  Wählen Sie das *Ereignis* gemäß Tabelle 2.
. *Speichern* Sie die Einstellungen.
.  Nehmen Sie die Einstellungen gemäß Tabelle 2 vor.
.  Setzen Sie ein Häkchen bei *Aktiv*.
. *Speichern* Sie die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Stornierungen an Sage Pay
[cols="1,3,3"]
|====
| Einstellung | Option | Auswahl

|*Ereignis*
|*Auftragsänderung: Statuswechsel*
| Status für *stornierte Aufträge* wählen.

|*Filter 1*
|*Auftrag &gt; Auftragstyp*
|*Auftrag*

|*Filter 2*
|*Auftrag &gt; Zahlungsart*
|*Sage Pay*

|*Aktion 1*
|*Zahlungsarten &gt; Stornierung an Sage Pay senden (Alle)*
|

|*Aktion 2*
|*Zahlungsarten &gt; Stornierung an Sage Pay senden (Authenticate)*
|

|*Aktion 3*
|*Zahlungsarten &gt; Stornierung an Sage Pay senden (Deferred)*
|
|====

[TIP]
.Pro Zahlungsart eine Ereignisaktion
====
Erstellen Sie für jede Zahlungsart eine eigene Ereignisaktion, da es sonst zu ungewollten Meldungen kommt. Wenn Sie im Tab *Filter* mehrere Zahlungsarten wählen, wird die ausgelöste Meldung auch für andere Zahlungsarten und an die dort hinterlegten Zahlungsanbieter geschickt. Wählen Sie unter Aktionen für *Deferred* und *Authenticate* außerdem immer 2 Aktionen.
====

[#120]
== Gutschriften automatisch senden

Wenn Sie eine Zahlung bereits erhalten haben und dem Kunden das Geld per Gutschrift erstatten möchten, richten Sie eine <<basics/automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um Gutschriften automatisch an Sage Pay zu senden.

[.collapseBox]
.Ereignisaktion einrichten
--
.  Öffnen Sie das Menü *System » Aufträge » Ereignisse*.
.  Klicken Sie auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
.  Geben Sie einen Namen ein.
.  Wählen Sie das *Ereignis* gemäß Tabelle 3.
. *Speichern* Sie die Einstellungen.
.  Nehmen Sie die Einstellungen gemäß Tabelle 3 vor.
.  Setzen Sie ein Häkchen bei *Aktiv*.
. *Speichern* Sie die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Gutschriften an Sage Pay
[cols="1,3,3"]
|====
| Einstellung | Option | Auswahl

|*Ereignis*
|*Auftragsanlage: Neue Gutschrift*
|

|*Filter*
|*Auftrag &gt; Zahlungsart*
|*Sage Pay*

|*Aktion*
|*Zahlungsarten &gt; Gutschrift an Sage Pay senden*
|
|====
