= Alter Webshop: PayPal
:lang: de
include::{includedir}/_header.adoc[]
:keywords: PayPal, Zahlungsart
:description: Payment in plentymarkets: Richten Sie die Schnittstelle zu PayPal in Ihrem plentymarkets System ein.
:position: 10

[IMPORTANT]
.Einrichtung der Schnittstelle nur in Callisto Shops
====
Diese Handbuchseite beschreibt ausschließlich die Einrichtung der Schnittstelle *PayPal* für Callisto Shops. Für die Verwendung von *PayPal* in Ceres Shops erhalten Sie ausführliche Informationen in der Beschreibung des Plugins im link:https://marketplace.plentymarkets.com/plugins/payment/PayPal_4690[plentyMarketplace^].
====

PayPal wird in der Kaufabwicklung als Zahlungsart für Marktplätze wie eBay oder Amazon, aber auch als Zahlungsmittel für Bestellungen über den Webshop genutzt. plentymarkets bietet PayPal im Webshop und bei der Kaufabwicklung zur Abwicklung von Zahlungen an. Weitere allgemeine Informationen über PayPal erhalten Sie auf unserer link:https://www.plentymarkets.eu/software/funktionen-technologie/online-shop/paypal/a-1698/[Webseite^].

[#10]
== Wichtige Hinweise

Nachdem der Kunde einen Artikel in den Warenkorb gelegt hat (auf der Seite 'AfterArticle2Basket'), wird ein Button angezeigt, über den der Kunde direkt zu PayPal weitergeleitet wird. Der Kunde muss sich daraufhin bei PayPal einloggen. Nach dem Bestätigen der Zahlung dort wird der Kunde automatisch zur Eingabe der Rechnungsanschrift in den Webshop zurückgeleitet. Dabei wird, sofern er nicht auch im Webshop eingeloggt ist, ein neuer Kunde angelegt. Der Kunde kann in dem Fall seine Daten noch entsprechend ändern. Danach durchläuft er die weiteren Schritte im Bestellvorgang wie üblich. Erst nach Abschluss der Bestellung wird die Zahlung durch PayPal veranlasst.

Der Ablauf kann auch aus dem Warenkorb heraus ausgeführt werden, wenn dort der entsprechende Button angeklickt wird. Darüber hinaus ist es auch möglich, PayPal erst in der Kaufabwicklung bei der Auswahl der Zahlungsart zu wählen. Hierbei wird man auf die PayPal-Seite weitergeleitet und es erfolgt derselbe Vorgang wie eben beschrieben.

[#20]
== Bei PayPal registrieren

Registrieren Sie sich zunächst bei link:https://www.paypal.com/de/merchantsignup/applicationChecklist?signupType=CREATE_NEW_ACCOUNT&productIntentId=pp_express[PayPal^]. Sie können für Ihre Zahlungen E-Mail-Adressen je Mandant (Shop) einrichten. Generell werden an die erste angegebene E-Mail-Adresse alle durch plentymarkets veranlassten Zahlungen übermittelt. Wenn Sie für einzelne Shops eine andere Adresse für die Zahlungen hinterlegen möchten, fügen Sie je Mandant (Shop) beim <<payment/zahlungsanbieter/paypal#30, Einrichten der Schnittstelle>> ein eigenes Konto hinzu.

[#30]
== PayPal in Callisto einrichten

Um die Schnittstelle zu PayPal für Ihren Callisto Shop in plentymarkets einzurichten, gehen Sie wie im Folgenden beschrieben vor.

[.instruction]
Schnittstelle zu PayPal einrichten:

. Öffnen Sie das Menü *System » Aufträge » Zahlung » Zahlungsarten*.
. Aktivieren Sie die Einstellung *Auch inaktive zeigen*.
. Öffnen Sie den Ordner *International*.
.  Klicken Sie auf *PayPal*. +
→ Das Tab *Einstellungen* wird geöffnet.
. Wechseln Sie in das Tab *Schnittstelle*.
.  Klappen Sie den Mandanten auf.
.  Nehmen Sie die Einstellungen vor. Beachten Sie dazu die Erläuterungen in <<tabelle-einrichtung-schnittstelle-paypal>>.
. *Speichern* Sie die Einstellungen.
. Klicken Sie auf *Konto hinzufügen*. +
→ Sie werden zu PayPal weitergeleitet.
. Loggen Sie sich ein.
. Bestätigen Sie den Zugriff auf Ihr PayPal-Konto durch plentymarkets. +
→ Sie werden in Ihr plentymarkets System weitergeleitet.
. *Speichern* Sie die Einstellungen.

[[tabelle-einrichtung-schnittstelle-paypal]]
.PayPal-Schnittstelle einrichten
[cols="1,3"]
|====
|Einstellung |Erläuterung

|*URL zu Ihrem Logo*
|Eine https-URL, die zum Logo-Bild führt. Gültige Formate sind .gif, .jpg oder .png. Die Maximalgröße beträgt 190 Pixel in der Breite und 60 Pixel in der Höhe. PayPal schneidet größere Bilder ab. PayPal platziert das Logo ganz oben in der Warenkorbübersicht.

|*Warenkorbumrandung*
|Der hexadezimale HTML-Code der Haupt-Erkennungsfarbe. PayPal lässt die Farbe in einem Rahmen um die Warenkorb-Übersicht in der PayPal-Checkout-Benutzeroberfläche stufenlos zu weiß verlaufen.

|*Zeitpunkt PayPal Zahlungseinzug*
|*Sale (sofortiger Zahlungseinzug)* = Zahlung direkt nach Abschluss der Bestellung einziehen. +
*Authorization &amp; Capture* = Bei Abschluss der Bestellung wird *Auth* ausgelöst und bei Versand *Capture*. Somit wird die Zahlung erst eingezogen, wenn *Capture* ausgelöst wird. +
*Order (OrderAuthCapture-Verfahren)* = Bei Abschluss der Bestellung, die in mehrere Teillieferungen aufgeteilt wird, wird *Auth* ausgelöst und bei Versand von Teillieferungen *Capture*. Teilzahlungen werden erst eingezogen, wenn *Capture* ausgelöst wird.

|*Standard (für alle Mandanten verwenden)*
|Nur sichtbar, wenn Mandanten eingerichtet sind. Aktivieren, um die Kontoeinstellungen, die über *Konto hinzufügen* für den Hauptshop gespeichert wurden, für alle Mandanten (Shops) zu übernehmen, unabhängig davon, was für andere Mandanten gespeichert wurde. Deaktivieren, um separate Zugangsdaten für weitere Mandanten (Shops) zu verwenden. Webshops, für die kein Konto hinzugefügt wurde, können mit PayPal nicht genutzt werden. +
Zur Unterstützung mehrerer Mandanten muss im Menü <<omni-channel/online-shop/webshop-einrichten#grundeinstellungen, System » Mandant » Mandant wählen » Webshop » Einstellungen>> für die Option *Login* die Einstellung *Login in jedem einzelnen Shop ermöglichen* aktiviert sein.
|====

[#40]
== Zahlungsart aktivieren

Richten Sie die <<payment/zahlungsarten-verwalten#20, Zahlungsart>> PayPal in Ihrem plentymarkets ein und aktivieren Sie die Zahlungsart. Prüfen Sie zudem die Einstellungen für *Erlaubte Zahlungsarten* in den <<payment/zahlungsarten-verwalten#30, Kundenklassen>> und für *Gesperrte Zahlungsarten* in den <<fulfillment/versand-vorbereiten#1000, Versandprofilen>>.

[WARNING]
.Achtung: AGB bei PayPal
====
Die Einstellung eines *Aufpreises* für die Entgegennahme der Bezahlung mit PayPal widerspricht den Allgemeinen Geschäftsbedingungen von PayPal.
====

[#50]
== PayPal sofortige Zahlungsbestätigung (IPN) aktivieren

plentymarkets stellt alle drei Stunden aktiv eine Anfrage an PayPal nach neuen Zahlungen. Hierbei wird der Zeitraum der letzten 48 Stunden abgefragt. Vielen Händlern ist dieses Abfrageintervall allerdings zu groß. Dieses kann über die PayPal-Option *Einstellungen für sofortige Zahlungsbestätigung (IPN)* verkürzt werden.

Bei Zahlungen über den plentymarkets Webshop oder Checkout wird die sofortige Zahlungsbestätigung automatisch aktiviert. Falls Ihre Endkunden aber über einen anderen Marktplatz, z.B. eBay, die Zahlung an Ihrem PayPal-Konto vornehmen, dann sollten Sie die sofortige Zahlungsbestätigung global für Ihr PayPal-Konto aktivieren. Dadurch stellen Sie sicher, dass auch tagelang offene Zahlungen wie z.B. *Überweisung über PayPal* wirklich in Ihrem plentymarkets System ankommen.

[.instruction]
PayPal-Funktion IPN aktivieren:

. Loggen Sie sich bei PayPal mit Ihrer E-Mail-Adresse ein.
. Wählen Sie den Bereich *Übersicht » Verkäufereinstellungen » Benachrichtigungen über Sofortzahlungen*.
. Klicken Sie auf *Einstellungen für sofortige Zahlungsbestätigung wählen*.
. Aktivieren Sie die Option.
. Geben Sie als Benachrichtigungs-URL folgende Adresse ein: +
*https://www.MEINE-SHOP-ADRESSE.de/plenty/api/payment_notification.php?payment=PayPal* +
→ Ersetzen Sie dabei *www.MEINE-SHOP-ADRESSE.de* durch Ihre eigene Shop-Domain.
. *Speichern* Sie die Einstellungen.

Die oben angegebene‚ Adresse funktioniert auch, wenn Sie die PayPal-Standard-Integration verwenden oder im Webshop PayPal als Zahlungsart nicht anbieten.

[WARNING]
.SSL-Zertifikat
====
Wenn Sie in Ihrem Webshop keine SSL-Verschlüsselung verwenden, verwenden Sie die URL mit http, statt mit https. Wir empfehlen die Verwendung eines <<basics/arbeiten-mit-plentymarkets/plentymarkets-konto#ssl-zertifikat, SSL-Zertifikats>>.
====

.Sofortige Zahlungsbestätigung (IPN) aktivieren
image::auftragsabwicklung/payment/assets/DE-Zahlungsarten-PayPal-01.png[]
[#60]
== UTF-8-Codierung einstellen

Damit UTF-8-Codierung, z.B. auch chinesische Zeichen, korrekt dargestellt wird, müssen Sie die folgenden Einstellungen in Ihrem PayPal-Konto vornehmen.

[.instruction]
UTF-8-Codierung einstellen:

. Loggen Sie sich bei PayPal mit Ihrer E-Mail-Adresse ein.
. Öffnen Sie den Bereich *Übersicht » Verkäufereinstellungen*.
. Klicken Sie auf *Sprachliche Kodierung von PayPal-Buttons*.
. Klicken Sie dort auf *Weitere Optionen*.
. Wählen Sie aus der Dropdown-Liste *Codierung* die Option *UTF-8* (<<bild-codierungsoptionen-paypal>>).
. Aktivieren Sie *Ja* für die Option, ob die gewählte Codierung auch verwendet werden soll, wenn PayPal Daten an Sie sendet.
. *Speichern* Sie die Einstellungen.

[[bild-codierungsoptionen-paypal]]
.Weitere Codierungsoptionen für PayPal
image::auftragsabwicklung/payment/assets/DE-Zahlungsarten-PayPal-02.png[]

[#70]
== Direkte Zahlungen an Ihre E-Mail-Adressen deaktivieren

Eine weitere Einstellung im PayPal-Konto kann für Händler sehr sinnvoll sein: *Deaktivieren von direkten Zahlungen an Ihre E-Mail-Adressen*. Mit der Funktion *Geld senden* können alle PayPal-Kunden nach Belieben Zahlungen an E-Mail-Adressen senden. Dabei ist die Angabe einer Lieferanschrift nicht erforderlich, wodurch wiederum der Verkäuferschutz außer Kraft gesetzt wird. Daher kann es Sinn machen, direkte Zahlungen an E-Mail-Adressen in Ihren PayPal-Einstellungen zu blockieren.

[.instruction]
Direkte Zahlungen an E-Mail-Adressen deaktivieren:

. Loggen Sie sich bei PayPal mit Ihrer E-Mail-Adresse ein.
. Öffnen Sie den Bereich *Übersicht » Verkäufereinstellungen » Zahlungen sperren*.
. Klicken Sie auf *Aktualisieren*.
. Aktivieren Sie die Option *Zahlungen über die Option "Zahlung senden" unter "Geld senden"*.
. *Speichern* Sie die Einstellungen.

.Einstellungen für den Zahlungsempfang
image::auftragsabwicklung/payment/assets/DE-Zahlungsarten-PayPal-03.png[]

[#80]
== PayPal-Abrechnungsbericht einrichten

Der PayPal-Abrechnungsbericht dient der Zuordnung von PayPal-Zahlungen zu Aufträgen, da in ihm alle Zahlungen eines Tages enthalten sind. Insbesondere bei einer Vielzahl an PayPal-Zahlungen ist der Abrechnungsbericht die sicherste Methode, um eine Zuordnung der Zahlungen zu Aufträgen zu gewährleisten. Für den Zugriff auf den FTP-Server, von dem die Abrechnungsberichte geladen werden, müssen Sie ein Extra-Konto bei PayPal erstellen und anschließend Ihren eigenen Benutzernamen generieren. Die Zugangsdaten zu diesem Konto geben Sie in plentymarkets ein.

[.instruction]
Zugangsdaten eingeben:

. Öffnen Sie das Menü *System » Aufträge » Zahlung » Zahlungsarten*.
. Aktivieren Sie die Einstellung *Auch inaktive zeigen*.
. Öffnen Sie den Ordner *International*.
.  Klicken Sie auf *PayPal*. +
→ Das Tab *Einstellungen* wird geöffnet.
. Wechseln Sie in das Tab *Abrechnungsbericht*.
. Geben Sie Ihren *User name* ein.
. Geben Sie das *Password* ein.
. *Speichern* Sie die Einstellungen. +
→ Der Abrechnungsbericht wird nun automatisch einmal täglich abgerufen.

Die abgerufenen Abrechnungsberichte sehen Sie im Dokumentenarchiv. Die Zuordnung der Zahlungen aus den Berichten erfolgt automatisch. Die Berichte müssen für eine Zuordnung nicht eingesehen werden.

[.instruction]
Abrechnungsbericht ansehen:

. Öffnen Sie das Menü *Aufträge » Dokumentenarchiv*.
. Wählen Sie in der Dropdown-Liste *Dokument* die Option *Abrechnungsbericht*. +
→ Weitere Einstellungen sind optional.
. *Speichern* Sie die Einstellungen.

Im <<basics/datenaustausch/api-log#6, API-Log>> finden Sie Einträge mit Informationen zum Verbindungsaufbau zum SFTP-Server von PayPal und z.B. zur Anzahl der im Abrechnungsbericht enthaltenen Transaktionen.

[#8]
== Gesamtbetrag erstatten und automatisch an PayPal senden

Um dem Käufer den gesamten Betrag zu erstatten, legen Sie einen Auftrag vom Typ *Gutschrift* an. Gutschriften werden automatisch der Zahlung zugeordnet.

[.instruction]
Gutschrift anlegen, um Gesamtbetrag zu erstatten:

. Öffnen Sie das Menü *Aufträge » Aufträge bearbeiten*.
. Öffnen Sie hier den gewünschten PayPal-Auftrag.
. Klicken Sie im Tab *Übersicht* auf die Dropdown-Liste *Gutschrift ...* und wählen Sie die Option *anlegen*. +
→ Die Gutschrift wird angelegt.

Anschließend richten Sie eine <<basics/automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um die Beträge automatisch an PayPal zu senden.

[.collapseBox]
.Ereignisaktion einrichten
--
. Öffnen Sie das Menü *System » Aufträge » Ereignisse*.
. Klicken Sie auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
. Geben Sie einen Namen ein.
. Wählen Sie das *Ereignis* gemäß Tabelle 2.
. *Speichern* Sie die Einstellungen.
. Nehmen Sie die Einstellungen gemäß Tabelle 2 vor.
. Setzen Sie ein Häkchen bei *Aktiv*.
. *Speichern* Sie die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Rückzahlungen an PayPal
[cols="1,3,3"]
|====
|Einstellung |Option |Auswahl

|*Ereignis*
|*Auftragsanlage: Neue Gutschrift*
|

|*Filter*
|*Auftrag &gt; Zahlungsart*
|*PayPal*

|*Aktion*
|*Zahlungsarten &gt; Rückzahlung an PayPal senden*
|
|====
