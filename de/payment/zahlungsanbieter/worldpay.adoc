= Alter Webshop: WorldPay
:lang: de
include::{includedir}/_header.adoc[]
:keywords: Worldpay, Zahlungsart
:description: Payment in plentymarkets: Richten Sie die Schnittstelle zu WorldPay in Ihrem plentymarkets System ein.
:position: 260


[IMPORTANT]
.Einrichtung der Schnittstelle nur in Callisto Shops
====
Diese Handbuchseite beschreibt ausschließlich die Einrichtung der Schnittstelle *WorldPay* in Callisto Shops. Die folgenden Anleitungen sind somit nicht für Ceres Shops gültig!
====

WorldPay ist ein Zahlungsanbieter mit Sitzen in den USA und dem Vereinigten Königreich, der es Ihnen als Online-Händler ermöglicht, Kartenzahlungen online entgegenzunehmen. Dies gilt sowohl für UK-Händler, die alle Services des Zahlungsanbieters nutzen können, als auch für deutsche Online-Händler, die das Angebot bis auf wenige Ausnahmen voll ausschöpfen können. Um zu wählen, welche Karten Sie für Zahlungen akzeptieren, setzen Sie sich bitte mit dem Support von WorldPay in Verbindung.

[#10]
== Wichtige Hinweise

In diesem Kapitel erhalten Sie wichtige Hinweise zur Integration des Zahlungsanbieters WorldPay in plentymarkets.

[.subhead]
Bezahlvorgang

Im Bestellvorgang kann Ihr Kunde wie gewohnt die Zahlungsart wählen. Entscheidet sich der Kunde für eine Zahlung über WorldPay, kann er oder sie in einem neuen Fenster die Art der Karte angeben und die Kartendaten eingeben. Eine Anmeldung bei WorldPay durch den Endkunden ist nicht nötig. Nach Authentifizierung der Daten wird der Kunde zurück in Ihren Webshop geleitet.

[IMPORTANT]
.Corporate Gateway
====
Die Anbindung von WorldPay an plentymarkets erfolgt über die WorldPay-Schnittstelle und basiert auf dem Vertragsmodell *Corporate Gateway*. Die CardPay-Schnittstelle wird nicht unterstützt.
====

[#20]
== Bei WorldPay registrieren

Um WorldPay in Ihrem Online-Shop als Zahlungsart zu integrieren, müssen Sie sich zunächst bei WorldPay registrieren und ein Konto freischalten. Füllen Sie dazu das link:https://secure.worldpay.com/app/[Worldpay-Anmeldeformular^] vollständig online aus und schicken Sie es ab. Informationen zum weiteren Verlauf erhalten Sie per E-Mail von WorldPay. Nachdem WorldPay Ihr Anmeldeformular akzeptiert hat, erhalten Sie Ihre WorldPay-Zugangsdaten sowie einen Link zum Freischaltungsauftrag, den Sie dann unter Angabe Ihrer Webshop-URL online ausfüllen und an WorldPay übermitteln. Im Anschluss prüft WorldPay die Funktionalität der Zahlungsseite Ihres Webshops und schaltet Sie dann zum Online-Handel auf den WorldPay-Systemen frei.

[#30]
== WorldPay in Callisto einrichten

Für die Einrichtung in plentymarkets benötigen Sie die Zugangsdaten, die im Händler-Backend von WorldPay im Menü *Profile* hinterlegt sind. Gehen Sie wie unten beschrieben vor, um die Schnittstelle zu WorldPay für Ihren Callisto Shop in plentymarkets einzurichten.

[.instruction]
Schnittstelle zu WorldPay einrichten:

. Öffnen Sie das Menü *System » Systemeinstellungen » Aufträge » Zahlung » Zahlungsarten*.
. Aktivieren Sie die Einstellung *Auch inaktive zeigen*.
. Öffnen Sie den Ordner *International*.
.  Klicken Sie auf *WorldPay*. +
→ Das Tab *Einstellungen* wird geöffnet.
. Wechseln Sie in das Tab *Schnittstelle*.
.  Klappen Sie den Mandanten auf.
.  Nehmen Sie die Einstellungen vor. Beachten Sie dazu die Erläuterungen in <<tabelle-schnittstelleneinrichtung-worldpay>>.
. *Speichern* Sie die Einstellungen.

[[tabelle-schnittstelleneinrichtung-worldpay]]
.Schnittstelle zu WorldPay einrichten
[cols="1,3"]
|====
|Einstellung |Erläuterung

|*Admin-ID*
|Admin-ID eingeben, wie von WorldPay erhalten.

|*Merchant-ID*
|Merchant-ID eingeben, wie von WorldPay erhalten.

|*XML-Passwort*
|Passwort eingeben, wie im WorldPay-Backend im Menü Profile gespeichert.

|*Max order amount in GBP*
|Maximal möglichen Transaktionsbetrag in Britischen Pfund eingeben.

|*Testbetrieb aktivieren*
|Testbetrieb aktivieren, um die WorldPay-Funktionen zu testen, bevor mit dem System live gearbeitet wird.

2+|Mandant (Shop) - Optionen

|*Zugangsdaten für alle Mandanten (Shops) aktivieren*
|Nur sichtbar, wenn Mandanten eingerichtet sind. Aktivieren, um die Kontoeinstellungen, die über *Konto hinzufügen* für den Hauptshop gespeichert wurden, für alle Mandanten (Shops) zu übernehmen, unabhängig davon, was für andere Mandanten gespeichert wurde. Deaktivieren, um separate Zugangsdaten für weitere Mandanten (Shops) zu verwenden. Webshops, für die kein Konto hinzugefügt wurde, können mit WorldPay nicht genutzt werden. +
Zur Unterstützung mehrerer Mandanten muss im Menü <<webshop/webshop-einrichten#grundeinstellungen, System » Systemeinstellungen » Mandant » Mandant wählen » Webshop » Einstellungen>> für die Option *Login* die Einstellung *Login in jedem einzelnen Shop ermöglichen* aktiviert sein.
|====

[#40]
== Zahlungsart aktivieren

Richten Sie die <<payment/zahlungsarten-verwalten#20, Zahlungsart>> für WorldPay im Tab *Einstellungen* der Zahlungsart ein. Prüfen Sie zudem die Einstellungen für *Erlaubte Zahlungsarten* in den <<payment/zahlungsarten-verwalten#30, Kundenklassen>> und für *Gesperrte Zahlungsarten* in den <<fulfillment/versand-vorbereiten#1000, Versandprofilen>>.

[#50]
== Einstellungen bei WorldPay vornehmen

In Ihrem Händler-Backend von WorldPay müssen Sie noch einige wichtige Daten hinterlegen, damit die Schnittstelle funktioniert. Loggen Sie sich dafür in Ihr Händlerkonto bei WorldPay ein und nehmen Sie folgende Einstellungen in Ihrem Profil unter *Händlerkanal* vor.

[#60]
=== Händlerkanal einrichten

Richten Sie den Händlerkanal im Backend von WorldPay ein.

* Im Bereich *Händlerkanäle* in der Zeile *http* die Option *Ja* unter *Aktiv* wählen.
* Unter *Inhalt* die Option *cgi* aus der Dropdown-Liste wählen.
* Unter *Adresse* die plentymarkets-URL nach folgendem Muster eingeben: *http://*ihr-plentyshop.de*/plenty/api/payment_notification.php?payment=worldpay* +
→ "ihr-plentyshop.de" durch eigenen Shop ersetzen.
* Unter *Methode* die Option *POST* aus der Dropdown-Liste wählen.
* Auf *Einstellungen speichern* klicken.

[#70]
=== Datenaustausch mit plentymarkets einstellen

Ebenfalls unter *Händlerkanal* geben Sie an, welche Informationen Sie über welchen Kanal von WorldPay erhalten möchten. Im Folgenden wird die empfohlene Variante für plentymarkets beschrieben, mit der die Daten direkt zu Ihrem System hinzugeführt werden.

* Im Bereich *Vorgänge Händlerkanäle* in der Zeile *http* die Optionen aktivieren, die an plentymarkets übertragen werden sollen.
* Auf *Einstellungen speichern* klicken.

[#80]
== Versandbestätigungen automatisch senden

Richten Sie eine <<automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um Versandbestätigungen automatisch zu versenden, nachdem der Warenausgang gebucht wurde. Durch die Versandbestätigung an WorldPay wird automatisch die Zahlung des Kunden von WorldPay an Sie übertragen. Hierdurch ändert sich der Zahlungsstatus bei WorldPay von *authorised* zu *captured*.

[.collapseBox]
.Ereignisaktion einrichten
--
.  Öffnen Sie das Menü *System » Systemeinstellungen » Aufträge » Ereignisse*.
.  Klicken Sie auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
.  Geben Sie einen Namen ein.
.  Wählen Sie das *Ereignis* gemäß Tabelle 2.
. *Speichern* Sie die Einstellungen.
.  Nehmen Sie die Einstellungen gemäß Tabelle 2 vor.
.  Setzen Sie ein Häkchen bei *Aktiv*.
. *Speichern* Sie die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Versandbestätigungen an WorldPay
[cols="1,3,3"]
|====
| Einstellung | Option | Auswahl

|*Ereignis*
|*Auftragsänderung: Warenausgang gebucht*
|

|*Filter 1*
|*Auftrag &gt; Zahlungsart*
|*WorldPay*

|*Filter 2*
|*Auftrag &gt; Auftragstyp*
|*Auftrag*

|*Aktion*
|*Versand &gt; Versandbestätigung an WorldPay senden*
|
|====

[#90]
== Stornierungen oder Gutschriften automatisch senden

Richten Sie eine <<automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um WorldPay automatisch über Stornierungen oder Gutschriften zu informieren.

[TIP]
.Tipp: Ereignisaktion für zwei Ereignisse
====
Richten Sie eine Ereignisaktion für zwei Ereignisse ein, da sich die Ereignisaktion dem Zahlungsstatus bei WorldPay anpasst. Befindet sich die Zahlung bei WorldPay noch im Status *authorised* (d.h. die Zahlung wurde noch nicht übermittelt), wird automatisch eine Stornierung versendet. Befindet sich die Zahlung bei WorldPay bereits im Status *captured* (d.h. die Zahlung wurde bereits übermittelt), wird automatisch eine Gutschrift versendet.
====

[.collapseBox]
.Ereignisaktion einrichten
--
.  Öffnen Sie das Menü *System » Systemeinstellungen » Aufträge » Ereignisse*.
.  Klicken Sie auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
.  Geben Sie einen Namen ein.
.  Wählen Sie das *Ereignis* gemäß Tabelle 3.
. *Speichern* Sie die Einstellungen.
.  Nehmen Sie die Einstellungen gemäß Tabelle 3 vor.
.  Setzen Sie ein Häkchen bei *Aktiv*.
. *Speichern* Sie die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Stornierungen oder Gutschriften an WorldPay
[cols="1,3,3"]
|====
| Einstellung | Option | Auswahl

|*Ereignis*
|*Auftragsänderung: Statuswechsel*
| Status für *stornierte Aufträge* wählen.

|*Filter 1*
|*Auftrag &gt; Auftragstyp*
|*Auftrag*

|*Filter 2*
|*Auftrag &gt; Zahlungsart*
|*WorldPay*

|*Aktion*
|*Zahlungsarten &gt; Stornierung oder Gutschrift an WorldPay senden*
|
|====

[#100]
== Stornierungen automatisch senden

Alternativ zur vorherigen Ereignisaktion, richten Sie eine <<automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um WorldPay automatisch über Stornierungen zu informieren. Mit dieser Ereignisaktion können Sie eine Zahlung nur dann stornieren, wenn Sie diese noch nicht mit der vorherigen Ereignisaktion eingeholt haben, also im Status *authorised* bei WorldPay. Richten Sie anschließend eine zweite Ereignisaktion ein, um WorldPay automatisch über <<payment/zahlungsanbieter/worldpay#110, Gutschriften>> zu informieren.

[.collapseBox]
.Ereignisaktion einrichten
--
.  Öffnen Sie das Menü *System » Systemeinstellungen » Aufträge » Ereignisse*.
.  Klicken Sie auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
.  Geben Sie einen Namen ein.
.  Wählen Sie das *Ereignis* gemäß Tabelle 4.
. *Speichern* Sie die Einstellungen.
.  Nehmen Sie die Einstellungen gemäß Tabelle 4 vor.
.  Setzen Sie ein Häkchen bei *Aktiv*.
. *Speichern* Sie die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Stornierungen an WorldPay
[cols="1,3,3"]
|====
| Einstellung | Option | Auswahl

|*Ereignis*
|*Auftragsänderung: Statuswechsel*
| Status für *stornierte Aufträge* wählen.

|*Filter 1*
|*Auftrag &gt; Auftragstyp*
|*Auftrag*

|*Filter 2*
|*Auftrag &gt; Zahlungsart*
|*WorldPay*

|*Aktion*
|*Zahlungsarten &gt; Stornierung an WorldPay senden*
|
|====

[#110]
== Gutschriften automatisch senden

Nachdem eine Zahlung von Ihnen bei WorldPay bereits abgeholt wurde, dort also den Status *captured* erhalten hat, können Sie keine Stornierungen, sondern nur noch Gutschriften zurücksenden. Richten Sie eine <<automatisierung/ereignisaktionen#, Ereignisaktion>> ein, um Gutschriften automatisch an WorldPay zu senden.

[.collapseBox]
.Ereignisaktion einrichten
--
.  Öffnen Sie das Menü *System » Systemeinstellungen » Aufträge » Ereignisse*.
.  Klicken Sie auf *Ereignisaktion hinzufügen*. +
→ Das Fenster *Neue Ereignisaktion erstellen* wird geöffnet.
.  Geben Sie einen Namen ein.
.  Wählen Sie das *Ereignis* gemäß Tabelle 5.
. *Speichern* Sie die Einstellungen.
.  Nehmen Sie die Einstellungen gemäß Tabelle 5 vor.
.  Setzen Sie ein Häkchen bei *Aktiv*.
. *Speichern* Sie die Einstellungen.
--
.Ereignisaktion zum automatischen Senden von Gutschriften an WorldPay
[cols="1,3,3"]
|====
| Einstellung | Option | Auswahl

|*Ereignis*
|*Auftragsanlage: Neue Gutschrift*
|

////
tr>
<td>
<strong>Filter 1</strong></td>
<td>
<strong>Auftrag > Auftragstyp</strong></td>
<td>
<strong>Gutschrift</strong></td>
</tr
////

|*Filter*
|*Auftrag &gt; Zahlungsart*
|*WorldPay*

|*Aktion*
|*Zahlungsarten &gt; Gutschrift an WorldPay senden*
|
|====

[#120]
== Gutschriften manuell anlegen

Es kann notwendig werden, für einzelne Aufträge, die über WorldPay abgewickelt werden, Gutschriften manuell zu erstellen. Sie haben hierfür die Möglichkeit, individuelle Gutschriftenbeträge an WorldPay zu melden. Gehen Sie dazu wie nachfolgend beschrieben vor.

[.instruction]
Gutschrift an WorldPay senden:

. Öffnen Sie das Menü *Aufträge » Aufträge bearbeiten*.
. Öffnen Sie hier den WorldPay-Auftrag. +
→ Das Tab *Übersicht* wird geöffnet.
. Wählen Sie die Option *anlegen* aus der Dropdown-Liste *Gutschrift ...*. +
→ Die Gutschrift wird angelegt.
. Öffnen Sie die neu angelegte *Gutschrift*.
. Wechseln Sie in das Tab *Einstellungen*.
. Geben Sie den Betrag in das Feld *WorldPay Gutschrift senden* ein.
. Klicken Sie auf *Gutschrift an WorldPay senden*. +
→ Die Gutschrift wird an WorldPay gesendet.
