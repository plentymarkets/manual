= Klarna Checkout
:lang: en
include::{includedir}/_header.adoc[]
:keywords: Klarna Checkout, payment method
:description: Payment in plentymarkets: Set up the interface to Klarna Checkout in your plentymarkets system.
:position: 20

link:https://klarna.com/de/mit-klarna-verkaufen/klarna-checkout[Klarna Checkout^] is an integrated checkout solution that allows you to offer your customers several payment methods. Klarna Checkout is responsive. Klarna is a European provider of payment solutions for online trading. Klarna Checkout is available for several countries of delivery in continental Europe. Only customers based in these countries can pay for orders using Klarna Checkout. Please refer to Klarna Checkout UK if you are interested in a checkout solution for the United Kingdom.

[#10]
== Important notes

This chapter provides you with important information about integrating the payment provider in plentymarkets.

[IMPORTANT]
.Klarna Checkout and store design
====
Note that the following conditions must be met before integrating Klarna Checkout successfully in plentymarkets:

* Use of the standard design Callisto (Version 2 or higher)
* Use of the individual order process
* Safe handling of the plentymarkets CMS
* Experience with integrating payment providers
====

[#20]
=== Payment process with Klarna Checkout

The payment process can be described as follows: The customers enter their email address and the postcode of their invoice address into the Klarna checkout. For Klarna customers, the invoice address is filled in automatically. The customer clicks on *Purchase now*. Purchase on invoice is selected by default, i.e. the customer receives an invoice by email once the ordered items were shipped. During the order confirmation, the customer can also select a different payment method, i.e. choose another payment method available in the Klarna Checkout. The page for switching the payment method is hosted by Klarna. For the customer, the order process is completed at this point. For the seller, plentymarkets creates an order in the system.

[#30]
=== SSL certificate

An iframe is used to integrate Klarna Checkout directly in plentymarkets. Thus, an <<basics/working-with-plentymarkets/plentymarkets-account#ssl-certificate, SSL certificate>> is required for using this payment method.

[#40]
=== Included payment methods

Klarna Checkout combines the following payment methods:

* Klarna Invoice
* Klarna Account
* Visa
* MasterCard
* SOFORT Überweisung
* Direct debit
* Further <<order-processing/payment/klarna-checkout#90, external payment methods>>

[#50]
== Registering with Klarna

If you would like to register with Klarna, then get in contact with them at the following email address: link:mailto:salj@klarna.com[salj@klarna.com]. You will receive the access data that you need for setting up Klarna in plentymarkets.

[#55]
== Setting up Klarna Checkout in plentymarkets

Proceed as described below to set up the interface to Klarna Checkout in plentymarkets.

[.instruction]
Setting up the interface to Klarna Checkout:

. Go to *System » Orders » Payment » Methods*.
. Place a check mark next to the setting *Also show inactive*.
. Open the folder *International*.
.  Open the folder *Klarna*.Click on *Klarna Checkout*. +
→ The *settings* tab will be opened.
. Click on the *Interface* tab.
.  Expand the client.
.  Carry out the settings as desired. Pay attention to the information given in <<table-setup-klarna-checkout-interface>>.
. *Save* the settings.

[[table-setup-klarna-checkout-interface]]
.setting up the interface to Klarna Checkout
[cols="1,3"]
|====
|Setting |Explanation

|*Activate access data for all clients (stores)*
|Option is only visible if clients (stores) were set up. +
*Yes* = The access data will be applied for all clients (stores), regardless of what is entered in the access data menus. +
*No* = The same access data can be entered for the default online store and for additional clients (stores). Alternatively, you can request separate access data for your clients (stores). +
Stores that do not have access data saved for them can not be used with Klarna Checkout. +
Go to <<omni-channel/online-store/setting-up-clients/online-store#, System » Client » Select client » Online store » Settings>> and make sure that you have selected the option *Enable login for every store* in the line *Login*. This makes it possible to support several clients.

|*Test mode / live*
|Activate either the test or the live mode. +
*sandbox* = test mode +
*live* = live mode

|*Default country*
|Select the default country. +
*_Important_*: In plentymarkets, Klarna Checkout is available for the <<order-processing/fulfilment/preparing-the-shipment#100, countries of delivery>> Germany, Austria, Finland, Norway and Sweden. This means that only customers based in these countries can pay orders using Klarna Checkout.

|*Telephone number as mandatory field*
|Activate to make the telephone number a mandatory field for customers.

|*Differing delivery address*
|Activate to allow customers to enter a different delivery address.

|*Activate Packstation*
|Activate to permit deliveries to Packstations. In this case, the option *Differing delivery address* also needs to be activated (see above). +
*_Note:_* DHL must be mentioned in the name of shipping profiles that permit delivery to Packstations.

|*External payment providers*
|Activate to permit external payment providers. +
The following payment methods can be offered in combination with Klarna Checkout: +
PayPal, Amazon Payments, Amex, cash in advance, cash on delivery, Giropay, cash payment, direct debit +
Check the spelling of these payment methods with Klarna because they need to be set up in plentymarkets exactly as specified by Klarna. Only <<order-processing/payment/managing-payment-methods#20, active payment methods>> are taken into account.

|*Date of birth as mandatory field*
|Activate to make the date of birth a mandatory field for customers. The date of birth is mandatory for the payment methods Klarna invoice, Klarna account and direct debit.

|*Deactivate autofocus*
|Place a check mark to deactivate the autofocus on the email field in the Klarna Checkout. Other fields of the online store are focussed.

|*Button - Colour; +
Button - Text colour; +
Checkbox - Colour; +
Checkbox - Check mark colour; +
Header - Colour; +
Link - Colour*
|Enter the Hexadecimal HTML codes of more appropriate colours if the Klarna Checkout's default colour scheme does not match the design of your online store.

|*eID; +
Shared secret*
|Enter the country-specific access data that you received from Klarna during the registration process.
|====

[#60]
== Activating the payment method

Set up and activate the <<order-processing/payment/managing-payment-methods#20, payment method>> Klarna Checkout in your plentymarkets system.

[#90]
== Permitting external payment methods in the Klarna Checkout

You can offer customers in Germany and Austria some external payment methods via the Klarna Checkout. However, you need Klarna to agree to these external payment methods. Therefore, contact Klarna before setting up external payment methods.

You need to spell the external payment methods exactly as specified by Klarna. Otherwise, Klarna will not accept the payment method. Check the exact spelling with Klarna before setting them up. The logos for the external payment providers also must have the exact size specified by Klarna. Some examples are given below. The default logos saved in plentymarkets are too big for the Klarna Checkout. +
The available payment methods and image sizes are:

* PayPal (276 x 48px)
* Amazon Payments (276 x 48px)
* Cash in advance (69 x 24px)
* Giropay (69 x 24px)
* Cash payment (69 x 24px)
* Direct debit (69 x 24px)
* Cash on delivery (69 x 24px)

Klarna continuously adds new external payment methods to the Klarna Checkout. Therefore, this list may not be complete.

[.instruction]
Permitting external payment methods:

. Go to *System » Orders » Payment » Methods*.
. Place a check mark next to the setting *Also show inactive*.
. Open the folder *International*.
.  Open the folder *Klarna*.Click on *Klarna Checkout*. +
→ The *settings* tab will be opened.
. Click on the *Interface* tab.
.  Expand the client.
. Activate the setting *External payment providers*.
. *Save* the setting.

Set up and activate the desired <<order-processing/payment/managing-payment-methods#20, payment methods>> in the *System » Orders » Payment » Methods* menu in your plentymarkets system.

[#70]
== Activating the currency conversion

If you use Klarna Checkout, then you will need to make invoice amounts visible to customers in their own currency. In other words, you will need to convert currencies. plentymarkets allows you to use live conversion. Alternatively, you enter a price into the price column that you use for the specific currency.

[.instruction]
Activating live currency conversion:

. Go to *System » Client » Select client » Online store » Currency*.
. Select the option *Live conversion* under *Currency conversion*.
. *Save* the settings.
. Go to *System » Orders » Payment » Currencies*.
. Select an option for the setting *Automatically update conversion factors daily*.
. *Save* the settings.

[.instruction]
Activating currency conversion using price columns:

. Go to *System » Client » Select client » Online store » Currency*.
. Select the option *use price column* under *Currency conversion*.
. *Save* the settings.
. Go to *System » Orders » Payment » Currencies*.
. Select a price column for each currency.
. *Save* the settings.

[#90]
== Displaying Klarna Checkout in the online store

This section explains how to add Klarna Checkout to the individual order process in plentymarkets. This is done in several steps.

[WARNING]
.No changes to the active design
====
Do not make changes to your active design. Before making changes to the design, make a backup copy so that you can restore the original state of the design.
====

[IMPORTANT]
.Do not insert the container for Klarna Checkout into the checkout templates
====
If you activated Klarna Checkout, then do not insert the container for Klarna Checkout *{% Container_CheckoutKlarnaCheckout() %}* into one of the checkout templates. Doing so may cause Klarna Checkout to interfere with the individual order process in plentymarkets. If you use Klarna Checkout, then make sure that end customers are able to access Klarna Checkout starting from the shopping cart preview. The shopping cart preview is in the template <<omni-channel/online-store/setting-up-clients/cms-syntax#web-design-itemview-container-itemviewbasketpreviewlist, ItemViewBasketPreviewList>> in the plentymarkets default designs.
====

[#100]
=== Adding the Select the country category

First, the following code example is inserted in a category of the type *Container*. The code example queries the country of delivery. Customers who live in countries where Klarna Checkout is not available will still be able to make purchases in your online store. You are required to make invoice amounts visible to customers in their own currency. This needs to be done for all of the countries where Klarna Checkout is available. Therefore, make sure that you convert currencies. The following descriptions are based on an unchanged Callisto design. If you have already begun customising the design, then you will need to take these modifications into consideration when using Klarna Checkout. Klarna Checkout is inserted in a category of the type *Container*.

[.instruction]
Creating a category of the type container:

. Go to *Item » Categories*.
. Click on *New category*. +
→ The *Create new category* window will open.
. Enter a name, e.g. Select the country.
. Click on *Create*. +
→ The category will be opened and the *Settings* tab will be displayed.
. Select the option *Container* as the *Type*.
. Click on the *Description 1* tab.
. Insert the code example.
. *Save* the settings.

Carry out additional settings, such as selecting the client, in the *Settings* tab.

[.subhead]
Code example for Klarna Checkout:

[source,plenty]
----
include::assets/EX-EN-Klarna-Checkout-Complete-Example.html[]

----
[#110]
=== Adding the Klarna Checkout category

Create a second category of the type *Container*, so that the Klarna Checkout is displayed to the customer after selecting a country of delivery.

[.instruction]
Creating a category of the type container:

. Go to *Item » Categories*.
. Click on *New category*. +
→ The *Create new category* window will open.
. Enter a name, e.g. Klarna Checkout.
. Click on *Create*. +
→ The category will be opened and the *Settings* tab will be displayed.
. Select the option *Container* as the *Type*.
. Click on the *Description 1* tab.
. Insert the container *{% Container_CheckoutKlarnaCheckout() %}* into the text field.
. *Save* the settings.

Carry out additional settings, such as selecting the client, in the *Settings* tab.

[#120]
=== Adding order steps

Both newly created categories need to be added to the order steps of the individual order process.

[.instruction]
Adding order steps:

. Go to *CMS » Web design*.
. Click on *Settings*.  +
→ The *Design settings* window will open.
. Click on the *Clients* tab.
. Click on a client.
. Click on the *Order process* tab.
. Click on *Search* for the 9th order process step.
. Select the newly created *Select the country* category.
. Click on *Select*.
. Click on *Search* for the 10th order step.
. Select the newly created *Klarna Checkout* category.
. Click on *Select*.
. *Save* the settings. +
→ The order steps will be added.

[#130]
=== Changing the order steps

The order steps are numbered for the individual order process. These numbers can be thought of as a sort of ID. "Purchase" is the 3rd order step in the individual order process. If you want to work with Klarna Checkout, then you will need to replace this order step with order step 9, i.e. with the order step for selecting a country of delivery and forwarding customers to Klarna Checkout. In addition, the shopping cart category needs to be edited so that customers who are logged into the online store will be able to access Klarna Checkout. The areas where order steps need to be customised are described below.

[.instruction]
Customising the Purchase category:

. Go to *Item » Categories*.
. Open your design folder to list the subcategories.
. Open the category *Log in*.
. Click on the *Description 1* tab.
. Search for *Link_Checkout(3)*. +
→ The link to the checkout should appear 2 times.
. Replace (3) with (9) in both instances.
. *Save* the settings.

The log in area also needs to include a note regarding the <<order-processing/payment/klarna-checkout#150, terms of use>>.

[.instruction]
Customising the Shopping cart category:

. Go to *Item » Categories*.
. Open your design folder to list the subcategories.
. Open the category *Shopping cart*.
. Click on the *Description 1* tab.
. Search for *Link_Checkout(3)*. +
→ The link to the checkout appears several times. However, only search for the instance with (3).
. Replace (3) with (9).
. *Save* the settings.

Also replace Link_Checkout(3) with Link_Checkout(9) in the categories *Order process* and *Registration*.

[#140]
=== Editing templates

Edit the templates *ItemViewBasketPreviewList*, *ItemViewItemToBasketConfirmationOverlay* and *NavigationCategories10Content* to ensure that Klarna Checkout is correctly used and displayed. Make sure that the design you edited is assigned to a client and was published. This ensures that Klarna Checkout is available in your online store.

[.instruction]
Editing the template ItemViewBasketPreviewList:

. Go to *CMS » Web design*.
. Open the folder *Layout*.
. Open the subfolder *ItemView*.
. Open the template *ItemViewBasketPreviewList*.
. Search for *Link_Checkout(3)*.
. Replace (3) with (9).
. *Save* the settings.

Also replace Link_Checkout(3) with Link_Checkout(9) in the templates *ItemViewItemToBasketConfirmationOverlay* and *NavigationCategories10Content*.

[#150]
=== Adding a note regarding terms of use

For German online stores, you need to insert a note regarding the Klarna Checkout's terms of use underneath the login. If you are using Callisto Light 2 with the individual order process, then insert the note into the category "Log in".

[.instruction]
Inserting note:

. Go to *Item » Categories*.
. Open the design's folder.
. Open the folder for the category *Log in*.
. Insert the note regarding terms of use into the code so that it will be displayed underneath the login.
. Include a link to the Klarna Checkout's terms of use in this note. +
→ The following link leads to the terms of use for Germany: link:https://cdn.klarna.com/1.0/shared/content/legal/terms/EID/de_de/checkout[https://cdn.klarna.com/1.0/shared/content/legal/terms/EID/de_de/checkout^] (only available in German).
. Replace the URL's *EID* with the ID of your Klarna account for Germany.
. *Save* the settings.

.note regarding the Klarna Checkout's terms of use
image::order-processing/payment/assets/EN-Payment-Methods-Klarna-Checkout-01.png[]

[#160]
=== Adding terms and conditions and cancellation rights

Your terms and conditions and cancellation rights will be displayed in the Klarna Checkout. You provide Klarna with the URL to the terms and conditions page of your plentymarkets system to achieve this. This page must also contain information regarding cancellation rights. You cannot provide this information on 2 different pages. Klarna adds the suffix #cancellation_rights to the URL to call up the information regarding cancellation rights. Therefore, you need to insert an anchor of the name *cancellation_rights* into the page. Proceed as follows to make sure the link sent to Klarna contains the relevant information.

[.instruction]
Adding terms and conditions and cancellation rights:

. Go to *Item » Categories*.
. Create a new category of the type *content* that contains both your terms and conditions and information regarding cancellation rights.
. Insert the anchor *cancellation_rights* into the category at the point where the information regarding cancellation rights begins.
. *Save* the settings.
. Go to *System » Client » Select client » Online store » Pages*.
. From the drop-down list *General terms and conditions page*, select the page that contains both the terms and conditions and the information regarding cancellation rights.
. *Save* the settings.

// h3>Mehrere Lieferländer anbieten<a id="170." name="170."></a></h3> <p>Wenn Sie alle mit Klarna möglichen Lieferländer nutzen möchten, müssen Sie das CMS Ihres Webshops anpassen. Dazu fügen Sie in das CMS Ihres Webshops ein Menü ein, das eine Kombination aus Lieferland und Währung setzt. Ohne diese Anpassung ist nur Deutschland als Lieferland verfügbar. In welches Layout-Template Sie die Anpassungen einfügen, hängt von Ihrem Design ab. Im folgenden Beispiel wird die Anpassung in <strong>PageDesignContent</strong> eingefügt.</p> <p>Die Anpassung ist im obigen Codebeispiel für Callisto schon enthalten. Wenn Sie den Code oben verwenden und der Beschreibung gefolgt sind, müssen Sie die folgenden Schritte nicht durchführen.</p> <h5>Mehrere Lieferländer anbieten:</h5> <ol> <li>Öffnen Sie das Menü <strong>CMS » Webdesign » Layout » PageDesign » PageDesignContent</strong>.<br /> → Welches Template Sie wählen, ist abhängig von Ihrem Design.</li> <li>Wechseln Sie in das Tab <strong>PageDesignContentMainFrame</strong>.</li> <li>Fügen Sie für jedes Lieferland eine Kombination aus Lieferland und Währung nach dem Schema <strong>Currency=EUR&ShipToCountry=ID</strong> ein.<br /> → Die IDs der Lieferländer finden Sie im Menü <strong><a href="{% Link(1596) %}">Versandoptionen</a></strong>.</li> <li>Klicken Sie auf <strong>Speichern</strong>, um die Einstellungen zu sichern.</li> </ol> <p><img alt="" class="pmManScreenshot" src="/documents/category/3268/DE-Zahlungsarten-Klarna-Checkout-02.png" /></p> <p><em>Bild 2: Beispiel zum Anbieten mehrerer Lieferländer</em></p
[#180]
== Automatically sending shipping confirmations

Set up event procedures to inform Klarna when items are shipped, orders and returns are cancelled and when invoices are created or deleted. Ask your contact person in the Klarna integration team to test the functionality before you start using the interface live. Set up an <<basics/automation/event-procedures#, event procedure>> to automatically send shipping confirmations to Klarna.

[.collapseBox]
.Setting up an event procedure
--
. Go to *System » Orders » Events*.
. Click on *Add event procedure*. +
→ The *Create new event procedure* window will open.
. Enter a name.
. Select the *event* listed in table 2.
. *Save* the settings.
. Pay attention to the explanations given in table 2 and carry out the settings as desired.
. Place a check mark next to the option *Active*.
. *Save* the settings.
--
.event procedure for sending automatic shipping confirmations to Klarna
[cols="1,3,3"]
|====
|Setting |Option |Selection

|*Event*
|*Order change: Outgoing items booked*
|

|*Filter 1*
|*Order &gt; Order type*
|*Order*

|*Filter 2*
|*Order &gt; Payment method*
|*Klarna Checkout*

|*Procedure*
|*Shipping &gt; Send shipping confirmation to Klarna*
|
|====

[TIP]
.Tip
====
The shipping confirmation informs Klarna that the order was shipped. It then activates the invoice, which will automatically be saved in the order as a PDF file. If you need the invoice earlier, then select an earlier event. However, please make sure that the items will actually be shipped.
====

[#190]
== Automatically sending returns

Set up an <<basics/automation/event-procedures#, event procedure>> to automatically send returns to Klarna. For further information about creating returns, refer to the <<order-processing/orders/managing-sales-orders#return, Return>> page of the manual.

[.collapseBox]
.Setting up an event procedure
--
. Go to *System » Orders » Events*.
. Click on *Add event procedure*. +
→ The *Create new event procedure* window will open.
. Enter a name.
. Select the *event* listed in table 3.
. *Save* the settings.
. Pay attention to the explanations given in table 3 and carry out the settings as desired.
. Place a check mark next to the option *Active*.
. *Save* the settings.
--
.event procedure for sending automatic returns to Klarna
[cols="1,3,3"]
|====
|Setting |Option |Selection

|*Event*
|*Order generation: New return (by customer)*
|

|*Filter 1*
|*Order &gt; Order type*
|*Return*

|*Filter 2*
|*Order &gt; Payment method*
|*Klarna Checkout*

|*Procedure*
|*Return &gt; Send return to Klarna*
|
|====

[#200]
== Automatically sending cancellations

Set up an <<basics/automation/event-procedures#, event procedure>> to automatically send cancellations to Klarna.

[.collapseBox]
.Setting up an event procedure
--
. Go to *System » Orders » Events*.
. Click on *Add event procedure*. +
→ The *Create new event procedure* window will open.
. Enter a name.
. Select the *event* listed in table 4.
. *Save* the settings.
. Pay attention to the explanations given in table 4 and carry out the settings as desired.
. Place a check mark next to the option *Active*.
. *Save* the settings.
--
.event procedure for sending automatic cancellations to Klarna
[cols="1,3,3"]
|====
|Setting |Option |Selection

|*Event*
|*Order change: Status change*
|

|*Filter 1*
|*Order &gt; Order type*
|*Order*

|*Filter 2*
|*Order &gt; Payment method*
|*Klarna Checkout*

|*Procedure*
|*Order &gt; Delete Klarna invoice*
|
|====

[#210]
== Editing Klarna orders

You can edit orders coming from Klarna until the outgoing items have been booked. You do this in the same way as for the payment methods Klarna Invoice and Klarna Account. For further information, refer to the <<order-processing/payment/klarna#20, Klarna>> page of the manual.

[#220]
== Tips for an efficient workflow

Please pay attention to a few important notes in order to make processing Klarna orders as easy as possible:

* You should always book the outgoing items and ship the items at the same time. This is because the 14 day payment deadline for payments on invoice begins for your customer when the outgoing items are booked.
* Klarna should be notified of returns as soon as possible in order to avoid dunning letters.
* If the customer cancels his or her order, then set it to the status *cancelled* as soon as possible so that the shopping cart value will no longer be reserved for the customer.
